<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ooyyhの小窝</title>
  
  <subtitle>朋友啊，你要明白，我们不能用温柔去应对黑暗，要用火。</subtitle>
  <link href="https://ooyyh.github.io/atom.xml" rel="self"/>
  
  <link href="https://ooyyh.github.io/"/>
  <updated>2026-01-04T14:40:55.353Z</updated>
  <id>https://ooyyh.github.io/</id>
  
  <author>
    <name>ooyyh</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Minecraft协议（六）Play状态详解</title>
    <link href="https://ooyyh.github.io/2026/01/04/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E5%85%AD%EF%BC%89Play%E7%8A%B6%E6%80%81%E8%AF%A6%E8%A7%A3/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E5%85%AD%EF%BC%89Play%E7%8A%B6%E6%80%81%E8%AF%A6%E8%A7%A3/"/>
    <id>https://ooyyh.github.io/2026/01/04/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E5%85%AD%EF%BC%89Play%E7%8A%B6%E6%80%81%E8%AF%A6%E8%A7%A3/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E5%85%AD%EF%BC%89Play%E7%8A%B6%E6%80%81%E8%AF%A6%E8%A7%A3/</id>
    <published>2026-01-04T14:38:53.000Z</published>
    <updated>2026-01-04T14:40:55.353Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Minecraft协议（六）Play状态详解"><a href="#Minecraft协议（六）Play状态详解" class="headerlink" title="Minecraft协议（六）Play状态详解"></a>Minecraft协议（六）Play状态详解</h1><p>在前面的章节中，我们详细探讨了握手、状态和登录包。一旦客户端成功登录，连接就会进入Play状态，这是Minecraft游戏中所有实际交互发生的地方。本章将详细介绍Play状态中的各种包。</p><h2 id="1-Play状态概述"><a href="#1-Play状态概述" class="headerlink" title="1. Play状态概述"></a>1. Play状态概述</h2><p>Play状态是Minecraft协议中最复杂和最重要的状态，它处理游戏中所有的交互，包括：</p><ul><li>玩家移动和位置更新</li><li>聊天消息</li><li>区块加载和更新</li><li>实体管理</li><li>物品交互</li><li>游戏状态更新</li></ul><h2 id="2-Play状态包的分类"><a href="#2-Play状态包的分类" class="headerlink" title="2. Play状态包的分类"></a>2. Play状态包的分类</h2><p>Play状态的包分为两大类：</p><ul><li><strong>客户端 → 服务器</strong>：处理玩家的输入和操作</li><li><strong>服务器 → 客户端</strong>：更新游戏世界状态</li></ul><h2 id="3-客户端-→-服务器-包"><a href="#3-客户端-→-服务器-包" class="headerlink" title="3. 客户端 → 服务器 包"></a>3. 客户端 → 服务器 包</h2><h3 id="3-1-位置和移动相关包"><a href="#3-1-位置和移动相关包" class="headerlink" title="3.1 位置和移动相关包"></a>3.1 位置和移动相关包</h3><h4 id="3-1-1-Player-Position-0x0D"><a href="#3-1-1-Player-Position-0x0D" class="headerlink" title="3.1.1 Player Position (0x0D)"></a>3.1.1 Player Position (0x0D)</h4><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x0D</td></tr><tr><td>X</td><td>Double</td><td>绝对X坐标</td></tr><tr><td>Y</td><td>Double</td><td>绝对Y坐标</td></tr><tr><td>Z</td><td>Double</td><td>绝对Z坐标</td></tr><tr><td>On Ground</td><td>Boolean</td><td>玩家是否在地面上</td></tr></tbody></table><h4 id="3-1-2-Player-Position-And-Rotation-0x0E"><a href="#3-1-2-Player-Position-And-Rotation-0x0E" class="headerlink" title="3.1.2 Player Position And Rotation (0x0E)"></a>3.1.2 Player Position And Rotation (0x0E)</h4><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x0E</td></tr><tr><td>X</td><td>Double</td><td>绝对X坐标</td></tr><tr><td>Y</td><td>Double</td><td>绝对Y坐标</td></tr><tr><td>Z</td><td>Double</td><td>绝对Z坐标</td></tr><tr><td>Yaw</td><td>Float</td><td>水平旋转角度</td></tr><tr><td>Pitch</td><td>Float</td><td>垂直旋转角度</td></tr><tr><td>On Ground</td><td>Boolean</td><td>玩家是否在地面上</td></tr></tbody></table><h4 id="3-1-3-Player-Rotation-0x0F"><a href="#3-1-3-Player-Rotation-0x0F" class="headerlink" title="3.1.3 Player Rotation (0x0F)"></a>3.1.3 Player Rotation (0x0F)</h4><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x0F</td></tr><tr><td>Yaw</td><td>Float</td><td>水平旋转角度</td></tr><tr><td>Pitch</td><td>Float</td><td>垂直旋转角度</td></tr><tr><td>On Ground</td><td>Boolean</td><td>玩家是否在地面上</td></tr></tbody></table><h3 id="3-2-聊天和交互相关包"><a href="#3-2-聊天和交互相关包" class="headerlink" title="3.2 聊天和交互相关包"></a>3.2 聊天和交互相关包</h3><h4 id="3-2-1-Chat-Message-0x03"><a href="#3-2-1-Chat-Message-0x03" class="headerlink" title="3.2.1 Chat Message (0x03)"></a>3.2.1 Chat Message (0x03)</h4><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x03</td></tr><tr><td>Message</td><td>String</td><td>聊天消息内容（最多256字符）</td></tr><tr><td>Timestamp</td><td>Long</td><td>消息发送时间戳</td></tr><tr><td>Salt</td><td>Long</td><td>随机盐值用于签名验证</td></tr><tr><td>Signature</td><td>Optional[ByteArray]</td><td>消息签名（1.19+）</td></tr><tr><td>Message Count</td><td>VarInt</td><td>消息计数</td></tr></tbody></table><h3 id="3-3-游戏控制相关包"><a href="#3-3-游戏控制相关包" class="headerlink" title="3.3 游戏控制相关包"></a>3.3 游戏控制相关包</h3><h4 id="3-3-1-Client-Status-0x04"><a href="#3-3-1-Client-Status-0x04" class="headerlink" title="3.3.1 Client Status (0x04)"></a>3.3.1 Client Status (0x04)</h4><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x04</td></tr><tr><td>Action ID</td><td>VarInt</td><td>动作ID (0&#x3D;请求重生, 1&#x3D;打开统计信息)</td></tr></tbody></table><h4 id="3-3-2-Client-Settings-0x05"><a href="#3-3-2-Client-Settings-0x05" class="headerlink" title="3.3.2 Client Settings (0x05)"></a>3.3.2 Client Settings (0x05)</h4><table><thead><tr><th>字�</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x05</td></tr><tr><td>Locale</td><td>String</td><td>客户端语言</td></tr><tr><td>View Distance</td><td>VarInt</td><td>渲染距离 (2-32)</td></tr><tr><td>Chat Mode</td><td>VarInt</td><td>聊天模式 (0&#x3D;启用, 1&#x3D;仅系统, 2&#x3D;隐藏)</td></tr><tr><td>Chat Colors</td><td>Boolean</td><td>是否启用聊天颜色</td></tr><tr><td>Displayed Skin Parts</td><td>Unsigned Byte</td><td>显示的皮肤部分位掩码</td></tr><tr><td>Main Hand</td><td>VarInt</td><td>主手 (0&#x3D;左手, 1&#x3D;右手)</td></tr></tbody></table><h2 id="4-服务器-→-客户端-包"><a href="#4-服务器-→-客户端-包" class="headerlink" title="4. 服务器 → 客户端 包"></a>4. 服务器 → 客户端 包</h2><h3 id="4-1-玩家和世界相关包"><a href="#4-1-玩家和世界相关包" class="headerlink" title="4.1 玩家和世界相关包"></a>4.1 玩家和世界相关包</h3><h4 id="4-1-1-Join-Game-0x26"><a href="#4-1-1-Join-Game-0x26" class="headerlink" title="4.1.1 Join Game (0x26)"></a>4.1.1 Join Game (0x26)</h4><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x26</td></tr><tr><td>Entity ID</td><td>Int</td><td>玩家实体ID</td></tr><tr><td>Is Hardcore</td><td>Boolean</td><td>是否为极限模式</td></tr><tr><td>Gamemode</td><td>Unsigned Byte</td><td>游戏模式 (0&#x3D;生存, 1&#x3D;创造, 2&#x3D;冒险, 3&#x3D;观察者)</td></tr><tr><td>Previous Gamemode</td><td>Unsigned Byte</td><td>之前的游戏模式</td></tr><tr><td>World Count</td><td>VarInt</td><td>世界数量</td></tr><tr><td>World Names</td><td>Array of String</td><td>世界名称列表</td></tr><tr><td>Dimension Codec</td><td>NBT</td><td>维度编解码器</td></tr><tr><td>Dimension</td><td>NBT</td><td>玩家所在维度</td></tr><tr><td>World Name</td><td>String</td><td>世界名称</td></tr><tr><td>Hashed Seed</td><td>Long</td><td>世界种子的哈希值</td></tr><tr><td>Max Players</td><td>VarInt</td><td>最大玩家数</td></tr><tr><td>View Distance</td><td>VarInt</td><td>渲染距离</td></tr><tr><td>Reduced Debug Info</td><td>Boolean</td><td>是否减少调试信息</td></tr><tr><td>Enable Respawn Screen</td><td>Boolean</td><td>是否启用重生屏幕</td></tr><tr><td>Is Debug</td><td>Boolean</td><td>是否为调试世界</td></tr><tr><td>Is Flat</td><td>Boolean</td><td>是否为超平坦世界</td></tr></tbody></table><h4 id="4-1-2-Player-Position-And-Look-0x38"><a href="#4-1-2-Player-Position-And-Look-0x38" class="headerlink" title="4.1.2 Player Position And Look (0x38)"></a>4.1.2 Player Position And Look (0x38)</h4><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x38</td></tr><tr><td>X</td><td>Double</td><td>绝对X坐标</td></tr><tr><td>Y</td><td>Double</td><td>绝对Y坐标</td></tr><tr><td>Z</td><td>Double</td><td>绝对Z坐标</td></tr><tr><td>Yaw</td><td>Float</td><td>水平旋转角度</td></tr><tr><td>Pitch</td><td>Float</td><td>垂直旋转角度</td></tr><tr><td>On Ground</td><td>Boolean</td><td>玩家是否在地面上</td></tr></tbody></table><h3 id="4-2-区块和实体相关包"><a href="#4-2-区块和实体相关包" class="headerlink" title="4.2 区块和实体相关包"></a>4.2 区块和实体相关包</h3><h4 id="4-2-1-Chunk-Data-0x22"><a href="#4-2-1-Chunk-Data-0x22" class="headerlink" title="4.2.1 Chunk Data (0x22)"></a>4.2.1 Chunk Data (0x22)</h4><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x22</td></tr><tr><td>Chunk X</td><td>Int</td><td>区块X坐标</td></tr><tr><td>Chunk Z</td><td>Int</td><td>区块Z坐标</td></tr><tr><td>Heightmaps</td><td>NBT</td><td>高度图</td></tr><tr><td>Biomes</td><td>Optional[Array of VarInt]</td><td>生物群系数据</td></tr><tr><td>Block Entities Count</td><td>VarInt</td><td>方块实体数量</td></tr><tr><td>Block Entities</td><td>Array of NBT</td><td>方块实体列表</td></tr><tr><td>Chunk Data</td><td>Array of Unsigned Bytes</td><td>区块数据</td></tr></tbody></table><h2 id="5-代码实现-Player-Position包解析器"><a href="#5-代码实现-Player-Position包解析器" class="headerlink" title="5. 代码实现 - Player Position包解析器"></a>5. 代码实现 - Player Position包解析器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PlayerPositionPacketParser</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PlayerPositionPacket</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> packetId;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> x, y, z;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> onGround;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">PlayerPositionPacket</span><span class="params">(<span class="type">int</span> packetId, <span class="type">double</span> x, <span class="type">double</span> y, <span class="type">double</span> z, <span class="type">boolean</span> onGround)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.packetId = packetId;</span><br><span class="line">            <span class="built_in">this</span>.x = x;</span><br><span class="line">            <span class="built_in">this</span>.y = y;</span><br><span class="line">            <span class="built_in">this</span>.z = z;</span><br><span class="line">            <span class="built_in">this</span>.onGround = onGround;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;PlayerPositionPacket&#123;packetId=0x&quot;</span> + Integer.toHexString(packetId) + </span><br><span class="line">                   <span class="string">&quot;, x=&quot;</span> + x + <span class="string">&quot;, y=&quot;</span> + y + <span class="string">&quot;, z=&quot;</span> + z + <span class="string">&quot;, onGround=&quot;</span> + onGround + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PlayerPositionPacket <span class="title function_">parse</span><span class="params">(<span class="type">byte</span>[] data)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data);</span><br><span class="line">        <span class="type">int</span> <span class="variable">packetId</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (packetId != <span class="number">0x0D</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;无效的Player Position包ID: &quot;</span> + packetId);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">double</span> <span class="variable">x</span> <span class="operator">=</span> stream.readDouble();</span><br><span class="line">        <span class="type">double</span> <span class="variable">y</span> <span class="operator">=</span> stream.readDouble();</span><br><span class="line">        <span class="type">double</span> <span class="variable">z</span> <span class="operator">=</span> stream.readDouble();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">onGround</span> <span class="operator">=</span> stream.read() != <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PlayerPositionPacket</span>(packetId, x, y, z, onGround);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readVarInt</span><span class="params">(ByteArrayInputStream stream)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentByte;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            currentByte = stream.read();</span><br><span class="line">            <span class="keyword">if</span> (currentByte == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;读取VarInt时到达流末尾&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            value |= (currentByte &amp; <span class="number">0x7F</span>) &lt;&lt; position;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ((currentByte &amp; <span class="number">0x80</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            position += <span class="number">7</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;VarInt格式错误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-代码实现-Player-Position-And-Rotation包解析器"><a href="#6-代码实现-Player-Position-And-Rotation包解析器" class="headerlink" title="6. 代码实现 - Player Position And Rotation包解析器"></a>6. 代码实现 - Player Position And Rotation包解析器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PlayerPositionAndRotationPacketParser</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PlayerPositionAndRotationPacket</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> packetId;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> x, y, z;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">float</span> yaw, pitch;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> onGround;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">PlayerPositionAndRotationPacket</span><span class="params">(<span class="type">int</span> packetId, <span class="type">double</span> x, <span class="type">double</span> y, <span class="type">double</span> z, </span></span><br><span class="line"><span class="params">                                              <span class="type">float</span> yaw, <span class="type">float</span> pitch, <span class="type">boolean</span> onGround)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.packetId = packetId;</span><br><span class="line">            <span class="built_in">this</span>.x = x;</span><br><span class="line">            <span class="built_in">this</span>.y = y;</span><br><span class="line">            <span class="built_in">this</span>.z = z;</span><br><span class="line">            <span class="built_in">this</span>.yaw = yaw;</span><br><span class="line">            <span class="built_in">this</span>.pitch = pitch;</span><br><span class="line">            <span class="built_in">this</span>.onGround = onGround;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;PlayerPositionAndRotationPacket&#123;packetId=0x&quot;</span> + Integer.toHexString(packetId) + </span><br><span class="line">                   <span class="string">&quot;, x=&quot;</span> + x + <span class="string">&quot;, y=&quot;</span> + y + <span class="string">&quot;, z=&quot;</span> + z + </span><br><span class="line">                   <span class="string">&quot;, yaw=&quot;</span> + yaw + <span class="string">&quot;, pitch=&quot;</span> + pitch + </span><br><span class="line">                   <span class="string">&quot;, onGround=&quot;</span> + onGround + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PlayerPositionAndRotationPacket <span class="title function_">parse</span><span class="params">(<span class="type">byte</span>[] data)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data);</span><br><span class="line">        <span class="type">int</span> <span class="variable">packetId</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (packetId != <span class="number">0x0E</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;无效的Player Position And Rotation包ID: &quot;</span> + packetId);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">double</span> <span class="variable">x</span> <span class="operator">=</span> stream.readDouble();</span><br><span class="line">        <span class="type">double</span> <span class="variable">y</span> <span class="operator">=</span> stream.readDouble();</span><br><span class="line">        <span class="type">double</span> <span class="variable">z</span> <span class="operator">=</span> stream.readDouble();</span><br><span class="line">        <span class="type">float</span> <span class="variable">yaw</span> <span class="operator">=</span> stream.readFloat();</span><br><span class="line">        <span class="type">float</span> <span class="variable">pitch</span> <span class="operator">=</span> stream.readFloat();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">onGround</span> <span class="operator">=</span> stream.read() != <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PlayerPositionAndRotationPacket</span>(packetId, x, y, z, yaw, pitch, onGround);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readVarInt</span><span class="params">(ByteArrayInputStream stream)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentByte;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            currentByte = stream.read();</span><br><span class="line">            <span class="keyword">if</span> (currentByte == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;读取VarInt时到达流末尾&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            value |= (currentByte &amp; <span class="number">0x7F</span>) &lt;&lt; position;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ((currentByte &amp; <span class="number">0x80</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            position += <span class="number">7</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;VarInt格式错误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-代码实现-Player-Position-And-Look包（服务器→客户端）解析器"><a href="#7-代码实现-Player-Position-And-Look包（服务器→客户端）解析器" class="headerlink" title="7. 代码实现 - Player Position And Look包（服务器→客户端）解析器"></a>7. 代码实现 - Player Position And Look包（服务器→客户端）解析器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PlayerPositionAndLookPacketParser</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PlayerPositionAndLookPacket</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> packetId;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> x, y, z;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">float</span> yaw, pitch;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> onGround;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> teleportId; <span class="comment">// 1.9+ 新增字段</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> dismountVehicle; <span class="comment">// 1.17+ 新增字段</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">PlayerPositionAndLookPacket</span><span class="params">(<span class="type">int</span> packetId, <span class="type">double</span> x, <span class="type">double</span> y, <span class="type">double</span> z, </span></span><br><span class="line"><span class="params">                                          <span class="type">float</span> yaw, <span class="type">float</span> pitch, <span class="type">boolean</span> onGround)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.packetId = packetId;</span><br><span class="line">            <span class="built_in">this</span>.x = x;</span><br><span class="line">            <span class="built_in">this</span>.y = y;</span><br><span class="line">            <span class="built_in">this</span>.z = z;</span><br><span class="line">            <span class="built_in">this</span>.yaw = yaw;</span><br><span class="line">            <span class="built_in">this</span>.pitch = pitch;</span><br><span class="line">            <span class="built_in">this</span>.onGround = onGround;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;PlayerPositionAndLookPacket&#123;packetId=0x&quot;</span> + Integer.toHexString(packetId) + </span><br><span class="line">                   <span class="string">&quot;, x=&quot;</span> + x + <span class="string">&quot;, y=&quot;</span> + y + <span class="string">&quot;, z=&quot;</span> + z + </span><br><span class="line">                   <span class="string">&quot;, yaw=&quot;</span> + yaw + <span class="string">&quot;, pitch=&quot;</span> + pitch + </span><br><span class="line">                   <span class="string">&quot;, onGround=&quot;</span> + onGround + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PlayerPositionAndLookPacket <span class="title function_">parse</span><span class="params">(<span class="type">byte</span>[] data)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data);</span><br><span class="line">        <span class="type">int</span> <span class="variable">packetId</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (packetId != <span class="number">0x38</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;无效的Player Position And Look包ID: &quot;</span> + packetId);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">double</span> <span class="variable">x</span> <span class="operator">=</span> stream.readDouble();</span><br><span class="line">        <span class="type">double</span> <span class="variable">y</span> <span class="operator">=</span> stream.readDouble();</span><br><span class="line">        <span class="type">double</span> <span class="variable">z</span> <span class="operator">=</span> stream.readDouble();</span><br><span class="line">        <span class="type">float</span> <span class="variable">yaw</span> <span class="operator">=</span> stream.readFloat();</span><br><span class="line">        <span class="type">float</span> <span class="variable">pitch</span> <span class="operator">=</span> stream.readFloat();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">onGround</span> <span class="operator">=</span> stream.read() != <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1.9+ 版本增加了teleport ID</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">teleportId</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (stream.available() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            teleportId = readVarInt(stream);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">PlayerPositionAndLookPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PlayerPositionAndLookPacket</span>(packetId, x, y, z, yaw, pitch, onGround);</span><br><span class="line">        packet.teleportId = teleportId;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> packet;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readVarInt</span><span class="params">(ByteArrayInputStream stream)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentByte;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            currentByte = stream.read();</span><br><span class="line">            <span class="keyword">if</span> (currentByte == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;读取VarInt时到达流末尾&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            value |= (currentByte &amp; <span class="number">0x7F</span>) &lt;&lt; position;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ((currentByte &amp; <span class="number">0x80</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            position += <span class="number">7</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;VarInt格式错误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-代码实现-Join-Game包解析器"><a href="#8-代码实现-Join-Game包解析器" class="headerlink" title="8. 代码实现 - Join Game包解析器"></a>8. 代码实现 - Join Game包解析器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JoinGamePacketParser</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">JoinGamePacket</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> packetId;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> entityId;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> isHardcore;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> gameMode;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> previousGameMode;</span><br><span class="line">        <span class="keyword">public</span> List&lt;String&gt; worldNames;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span>[] dimensionCodec; <span class="comment">// 实际上是NBT格式</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span>[] dimension; <span class="comment">// 实际上是NBT格式</span></span><br><span class="line">        <span class="keyword">public</span> String worldName;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">long</span> hashedSeed;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> maxPlayers;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> viewDistance;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> reducedDebugInfo;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> enableRespawnScreen;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> isDebug;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> isFlat;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">JoinGamePacket</span><span class="params">()</span> &#123;</span><br><span class="line">            worldNames = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;JoinGamePacket&#123;packetId=0x&quot;</span> + Integer.toHexString(packetId) + </span><br><span class="line">                   <span class="string">&quot;, entityId=&quot;</span> + entityId + </span><br><span class="line">                   <span class="string">&quot;, gameMode=&quot;</span> + gameMode + </span><br><span class="line">                   <span class="string">&quot;, worldName=&#x27;&quot;</span> + worldName + <span class="string">&quot;&#x27;&#125;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> JoinGamePacket <span class="title function_">parse</span><span class="params">(<span class="type">byte</span>[] data)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data);</span><br><span class="line">        <span class="type">int</span> <span class="variable">packetId</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (packetId != <span class="number">0x26</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;无效的Join Game包ID: &quot;</span> + packetId);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">JoinGamePacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JoinGamePacket</span>();</span><br><span class="line">        packet.packetId = packetId;</span><br><span class="line">        </span><br><span class="line">        packet.entityId = stream.readInt();</span><br><span class="line">        packet.isHardcore = stream.read() != <span class="number">0</span>;</span><br><span class="line">        packet.gameMode = stream.read();</span><br><span class="line">        packet.previousGameMode = stream.read();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取世界名称数量</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">worldNameCount</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; worldNameCount; i++) &#123;</span><br><span class="line">            packet.worldNames.add(readString(stream));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取维度编解码器 (NBT格式，这里简化处理)</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">dimensionCodecLength</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        packet.dimensionCodec = <span class="keyword">new</span> <span class="title class_">byte</span>[dimensionCodecLength];</span><br><span class="line">        stream.read(packet.dimensionCodec);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取维度 (NBT格式，这里简化处理)</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">dimensionLength</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        packet.dimension = <span class="keyword">new</span> <span class="title class_">byte</span>[dimensionLength];</span><br><span class="line">        stream.read(packet.dimension);</span><br><span class="line">        </span><br><span class="line">        packet.worldName = readString(stream);</span><br><span class="line">        packet.hashedSeed = stream.readLong();</span><br><span class="line">        packet.maxPlayers = readVarInt(stream);</span><br><span class="line">        packet.viewDistance = readVarInt(stream);</span><br><span class="line">        packet.reducedDebugInfo = stream.read() != <span class="number">0</span>;</span><br><span class="line">        packet.enableRespawnScreen = stream.read() != <span class="number">0</span>;</span><br><span class="line">        packet.isDebug = stream.read() != <span class="number">0</span>;</span><br><span class="line">        packet.isFlat = stream.read() != <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> packet;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readVarInt</span><span class="params">(ByteArrayInputStream stream)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentByte;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            currentByte = stream.read();</span><br><span class="line">            <span class="keyword">if</span> (currentByte == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;读取VarInt时到达流末尾&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            value |= (currentByte &amp; <span class="number">0x7F</span>) &lt;&lt; position;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ((currentByte &amp; <span class="number">0x80</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            position += <span class="number">7</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;VarInt格式错误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">readString</span><span class="params">(ByteArrayInputStream stream)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        <span class="type">byte</span>[] stringData = <span class="keyword">new</span> <span class="title class_">byte</span>[length];</span><br><span class="line">        <span class="keyword">if</span> (stream.read(stringData) != length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;读取字符串时到达流末尾&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(stringData, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9-代码实现-Chat-Message包构建器"><a href="#9-代码实现-Chat-Message包构建器" class="headerlink" title="9. 代码实现 - Chat Message包构建器"></a>9. 代码实现 - Chat Message包构建器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatMessagePacketBuilder</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] build(String message) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Packet ID (0x03)</span></span><br><span class="line">        writeVarInt(stream, <span class="number">0x03</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入消息内容</span></span><br><span class="line">        writeString(stream, message);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入时间戳 (当前时间)</span></span><br><span class="line">        stream.writeLong(System.currentTimeMillis());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入随机盐值</span></span><br><span class="line">        stream.writeLong((<span class="type">long</span>)(Math.random() * Long.MAX_VALUE));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 暂时写入空签名 (1.19+ 需要)</span></span><br><span class="line">        writeVarInt(stream, <span class="number">0</span>); <span class="comment">// 签名长度为0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入消息计数 (简单实现)</span></span><br><span class="line">        writeVarInt(stream, <span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> stream.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeVarInt</span><span class="params">(ByteArrayOutputStream stream, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((value &amp; <span class="number">0xFFFFFF80</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                stream.write(value);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            stream.write((value &amp; <span class="number">0x7F</span>) | <span class="number">0x80</span>);</span><br><span class="line">            value &gt;&gt;&gt;= <span class="number">7</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeString</span><span class="params">(ByteArrayOutputStream stream, String value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">byte</span>[] stringData = value.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">        writeVarInt(stream, stringData.length);</span><br><span class="line">        stream.write(stringData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-完整的Play状态包处理器示例"><a href="#10-完整的Play状态包处理器示例" class="headerlink" title="10. 完整的Play状态包处理器示例"></a>10. 完整的Play状态包处理器示例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PlayStatePacketHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 包ID到处理器的映射</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Integer, PacketProcessor&gt; clientBoundProcessors = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Integer, PacketProcessor&gt; serverBoundProcessors = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// 客户端→服务器包处理器</span></span><br><span class="line">        serverBoundProcessors.put(<span class="number">0x0D</span>, data -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> PlayerPositionPacketParser.parse(data);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;解析Player Position包失败&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        serverBoundProcessors.put(<span class="number">0x0E</span>, data -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> PlayerPositionAndRotationPacketParser.parse(data);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;解析Player Position And Rotation包失败&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        serverBoundProcessors.put(<span class="number">0x0F</span>, data -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">ByteArrayInputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data);</span><br><span class="line">                <span class="type">int</span> <span class="variable">packetId</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">                <span class="type">float</span> <span class="variable">yaw</span> <span class="operator">=</span> stream.readFloat();</span><br><span class="line">                <span class="type">float</span> <span class="variable">pitch</span> <span class="operator">=</span> stream.readFloat();</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">onGround</span> <span class="operator">=</span> stream.read() != <span class="number">0</span>;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;Player Rotation&quot;</span>, <span class="string">&quot;yaw=&quot;</span> + yaw + <span class="string">&quot;, pitch=&quot;</span> + pitch + <span class="string">&quot;, onGround=&quot;</span> + onGround&#125;;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;解析Player Rotation包失败&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 服务器→客户端包处理器</span></span><br><span class="line">        clientBoundProcessors.put(<span class="number">0x26</span>, data -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> JoinGamePacketParser.parse(data);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;解析Join Game包失败&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        clientBoundProcessors.put(<span class="number">0x38</span>, data -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> PlayerPositionAndLookPacketParser.parse(data);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;解析Player Position And Look包失败&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@FunctionalInterface</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PacketProcessor</span> &#123;</span><br><span class="line">        Object <span class="title function_">process</span><span class="params">(<span class="type">byte</span>[] data)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理来自服务器的包 (客户端接收)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">handleServerBoundPacket</span><span class="params">(<span class="type">int</span> packetId, <span class="type">byte</span>[] data)</span> &#123;</span><br><span class="line">        <span class="type">PacketProcessor</span> <span class="variable">processor</span> <span class="operator">=</span> clientBoundProcessors.get(packetId);</span><br><span class="line">        <span class="keyword">if</span> (processor != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> processor.process(data);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;Unknown packet&quot;</span>, <span class="string">&quot;ID: 0x&quot;</span> + Integer.toHexString(packetId)&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理来自客户端的包 (服务器接收)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">handleClientBoundPacket</span><span class="params">(<span class="type">int</span> packetId, <span class="type">byte</span>[] data)</span> &#123;</span><br><span class="line">        <span class="type">PacketProcessor</span> <span class="variable">processor</span> <span class="operator">=</span> serverBoundProcessors.get(packetId);</span><br><span class="line">        <span class="keyword">if</span> (processor != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> processor.process(data);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;Unknown packet&quot;</span>, <span class="string">&quot;ID: 0x&quot;</span> + Integer.toHexString(packetId)&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实用工具方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readVarInt</span><span class="params">(ByteArrayInputStream stream)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentByte;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            currentByte = stream.read();</span><br><span class="line">            <span class="keyword">if</span> (currentByte == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;读取VarInt时到达流末尾&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            value |= (currentByte &amp; <span class="number">0x7F</span>) &lt;&lt; position;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ((currentByte &amp; <span class="number">0x80</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            position += <span class="number">7</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;VarInt格式错误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeVarInt</span><span class="params">(ByteArrayOutputStream stream, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((value &amp; <span class="number">0xFFFFFF80</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                stream.write(value);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            stream.write((value &amp; <span class="number">0x7F</span>) | <span class="number">0x80</span>);</span><br><span class="line">            value &gt;&gt;&gt;= <span class="number">7</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="11-Play状态下的完整游戏循环示例"><a href="#11-Play状态下的完整游戏循环示例" class="headerlink" title="11. Play状态下的完整游戏循环示例"></a>11. Play状态下的完整游戏循环示例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinecraftPlayStateExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">startPlayStateHandling</span><span class="params">(Socket socket)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">DataInputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(socket.getInputStream());</span><br><span class="line">        <span class="type">DataOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(socket.getOutputStream());</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;进入Play状态，开始处理游戏数据包...&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 这是一个简化的示例，实际实现需要更复杂的逻辑</span></span><br><span class="line">        <span class="keyword">while</span> (!socket.isClosed()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 读取包长度</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">packetLength</span> <span class="operator">=</span> readVarInt(input);</span><br><span class="line">                <span class="keyword">if</span> (packetLength &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;连接关闭或包长度无效&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 读取包数据</span></span><br><span class="line">                <span class="type">byte</span>[] packetData = <span class="keyword">new</span> <span class="title class_">byte</span>[packetLength];</span><br><span class="line">                input.readFully(packetData);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 读取包ID</span></span><br><span class="line">                <span class="type">ByteArrayInputStream</span> <span class="variable">packetStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(packetData);</span><br><span class="line">                <span class="type">int</span> <span class="variable">packetId</span> <span class="operator">=</span> readVarInt(packetStream);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 根据包ID处理不同类型的包</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> PlayStatePacketHandler.handleServerBoundPacket(packetId, packetData);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (result <span class="keyword">instanceof</span> JoinGamePacketParser.JoinGamePacket) &#123;</span><br><span class="line">                    JoinGamePacketParser.<span class="type">JoinGamePacket</span> <span class="variable">joinPacket</span> <span class="operator">=</span> </span><br><span class="line">                        (JoinGamePacketParser.JoinGamePacket) result;</span><br><span class="line">                    System.out.println(<span class="string">&quot;玩家加入游戏: &quot;</span> + joinPacket);</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// 在实际实现中，这里会初始化玩家的游戏状态</span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result <span class="keyword">instanceof</span> PlayerPositionAndLookPacketParser.PlayerPositionAndLookPacket) &#123;</span><br><span class="line">                    PlayerPositionAndLookPacketParser.<span class="type">PlayerPositionAndLookPacket</span> <span class="variable">posPacket</span> <span class="operator">=</span> </span><br><span class="line">                        (PlayerPositionAndLookPacketParser.PlayerPositionAndLookPacket) result;</span><br><span class="line">                    System.out.println(<span class="string">&quot;玩家位置更新: &quot;</span> + posPacket);</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// 在实际实现中，这里会更新玩家在世界中的位置</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;收到未知包: &quot;</span> + result);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 这里可以添加发送响应包的逻辑</span></span><br><span class="line">                <span class="comment">// 例如，响应位置更新包确认收到</span></span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;处理包时发生错误: &quot;</span> + e.getMessage());</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readVarInt</span><span class="params">(DataInputStream input)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentByte;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            currentByte = input.read();</span><br><span class="line">            <span class="keyword">if</span> (currentByte == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;读取VarInt时到达流末尾&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            value |= (currentByte &amp; <span class="number">0x7F</span>) &lt;&lt; position;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ((currentByte &amp; <span class="number">0x80</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            position += <span class="number">7</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;VarInt格式错误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-常见问题和注意事项"><a href="#12-常见问题和注意事项" class="headerlink" title="12. 常见问题和注意事项"></a>12. 常见问题和注意事项</h2><h3 id="12-1-版本兼容性"><a href="#12-1-版本兼容性" class="headerlink" title="12.1 版本兼容性"></a>12.1 版本兼容性</h3><ul><li>不同Minecraft版本的包结构可能有差异</li><li>某些字段可能在特定版本中添加或移除</li><li>需要根据目标版本调整解析逻辑</li></ul><h3 id="12-2-性能考虑"><a href="#12-2-性能考虑" class="headerlink" title="12.2 性能考虑"></a>12.2 性能考虑</h3><ul><li>Play状态包频繁发送和接收</li><li>需要高效的解析和序列化实现</li><li>考虑使用对象池来减少GC压力</li></ul><h3 id="12-3-网络安全"><a href="#12-3-网络安全" class="headerlink" title="12.3 网络安全"></a>12.3 网络安全</h3><ul><li>验证包的长度和内容</li><li>防止包大小攻击</li><li>验证玩家操作的合理性（如瞬移检测）</li></ul><h2 id="13-小结"><a href="#13-小结" class="headerlink" title="13. 小结"></a>13. 小结</h2><p>Play状态是Minecraft协议中最复杂的部分，处理游戏中所有的交互。理解Play状态的包结构对于开发Minecraft客户端或服务器至关重要。</p><p>在本章中，我们详细介绍了：</p><ul><li>位置和移动相关的包</li><li>聊天和交互相关的包</li><li>Join Game等重要的初始化包</li><li>实际的代码实现示例</li></ul><p>Play状态的内容非常丰富，还有很多其他类型的包（如实体管理、物品交互、区块加载等）没有在本章中详细讨论，但基本原理是相同的。</p><p>通过本系列文章的学习，您现在应该对Minecraft协议有了全面的了解，从握手到登录，再到实际的游戏交互。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Minecraft协议（六）Play状态详解&quot;&gt;&lt;a href=&quot;#Minecraft协议（六）Play状态详解&quot; class=&quot;headerlink&quot; title=&quot;Minecraft协议（六）Play状态详解&quot;&gt;&lt;/a&gt;Minecraft协议（六）Play状态</summary>
      
    
    
    
    <category term="MinecraftProtocol" scheme="https://ooyyh.github.io/categories/MinecraftProtocol/"/>
    
    
    <category term="Minecraft" scheme="https://ooyyh.github.io/tags/Minecraft/"/>
    
    <category term="协议" scheme="https://ooyyh.github.io/tags/%E5%8D%8F%E8%AE%AE/"/>
    
    <category term="Play状态" scheme="https://ooyyh.github.io/tags/Play%E7%8A%B6%E6%80%81/"/>
    
    <category term="游戏交互" scheme="https://ooyyh.github.io/tags/%E6%B8%B8%E6%88%8F%E4%BA%A4%E4%BA%92/"/>
    
  </entry>
  
  <entry>
    <title>Minecraft协议（五）登录包详解</title>
    <link href="https://ooyyh.github.io/2026/01/04/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%BA%94%EF%BC%89%E7%99%BB%E5%BD%95%E5%8C%85%E8%AF%A6%E8%A7%A3/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%BA%94%EF%BC%89%E7%99%BB%E5%BD%95%E5%8C%85%E8%AF%A6%E8%A7%A3/"/>
    <id>https://ooyyh.github.io/2026/01/04/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%BA%94%EF%BC%89%E7%99%BB%E5%BD%95%E5%8C%85%E8%AF%A6%E8%A7%A3/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%BA%94%EF%BC%89%E7%99%BB%E5%BD%95%E5%8C%85%E8%AF%A6%E8%A7%A3/</id>
    <published>2026-01-04T14:35:16.000Z</published>
    <updated>2026-01-04T14:38:37.817Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Minecraft协议（五）登录包详解"><a href="#Minecraft协议（五）登录包详解" class="headerlink" title="Minecraft协议（五）登录包详解"></a>Minecraft协议（五）登录包详解</h1><p>在前面的章节中，我们探讨了握手包和状态包。本章将深入解析Minecraft协议中的登录包，这是实现用户登录服务器的关键部分。</p><h2 id="1-登录包概述"><a href="#1-登录包概述" class="headerlink" title="1. 登录包概述"></a>1. 登录包概述</h2><p>当客户端在握手包中指定Next State为2（login）时，接下来就会进入登录阶段。在这个阶段，客户端需要向服务器发送登录信息，包括用户名或UUID，然后服务器会验证用户身份并建立加密连接。</p><h2 id="2-登录阶段的包类型"><a href="#2-登录阶段的包类型" class="headerlink" title="2. 登录阶段的包类型"></a>2. 登录阶段的包类型</h2><p>登录阶段包含以下几种包：</p><h3 id="2-1-客户端-→-服务器"><a href="#2-1-客户端-→-服务器" class="headerlink" title="2.1 客户端 → 服务器"></a>2.1 客户端 → 服务器</h3><ul><li><strong>Login Start</strong> (0x00): 客户端发送用户名</li><li><strong>Encryption Response</strong> (0x01): 客户端响应服务器的加密请求</li></ul><h3 id="2-2-服务器-→-客户端"><a href="#2-2-服务器-→-客户端" class="headerlink" title="2.2 服务器 → 客户端"></a>2.2 服务器 → 客户端</h3><ul><li><strong>Login Disconnect</strong> (0x00): 登录过程中断开连接</li><li><strong>Encryption Request</strong> (0x01): 服务器请求客户端加密连接</li><li><strong>Login Success</strong> (0x02): 登录成功</li><li><strong>Set Compression</strong> (0x03): 设置压缩阈值（可选）</li></ul><h2 id="3-Login-Start-包"><a href="#3-Login-Start-包" class="headerlink" title="3. Login Start 包"></a>3. Login Start 包</h2><p>这是客户端在登录阶段发送的第一个包，用于告知服务器其用户名。</p><h3 id="3-1-包结构"><a href="#3-1-包结构" class="headerlink" title="3.1 包结构"></a>3.1 包结构</h3><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x00 (Login Start)</td></tr><tr><td>Username</td><td>String</td><td>客户端用户名</td></tr></tbody></table><h3 id="3-2-实际包示例"><a href="#3-2-实际包示例" class="headerlink" title="3.2 实际包示例"></a>3.2 实际包示例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x00, 0x08, 0x64, 0x69, 0x6C, 0x6C, 0x6F, 0x6E, 0x67, 0x65, 0x72</span><br></pre></td></tr></table></figure><p>解析：</p><ul><li><code>0x00</code> - Packet ID (0x00 for Login Start)</li><li><code>0x08</code> - Username字符串长度 (VarInt: 8)</li><li><code>0x64, 0x69, 0x6C, 0x6C, 0x6F, 0x6E, 0x67, 0x65, 0x72</code> - “dillonger”的UTF-8编码</li></ul><h2 id="4-Login-Success-包"><a href="#4-Login-Success-包" class="headerlink" title="4. Login Success 包"></a>4. Login Success 包</h2><p>当服务器验证用户身份后，会发送Login Success包。</p><h3 id="4-1-包结构"><a href="#4-1-包结构" class="headerlink" title="4.1 包结构"></a>4.1 包结构</h3><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x02 (Login Success)</td></tr><tr><td>UUID</td><td>String</td><td>用户的UUID</td></tr><tr><td>Username</td><td>String</td><td>用户名</td></tr></tbody></table><h3 id="4-2-实际包示例"><a href="#4-2-实际包示例" class="headerlink" title="4.2 实际包示例"></a>4.2 实际包示例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x02, 0x20, 0x34, 0x30, 0x34, 0x38, 0x39, 0x32, 0x34, 0x32, 0x2D, 0x34, 0x34, 0x34, 0x38, 0x2D, 0x34, 0x38, 0x34, 0x32, 0x2D, 0x34, 0x30, 0x34, 0x38, 0x2D, 0x39, 0x32, 0x34, 0x34, 0x34, 0x38, 0x34, 0x32, 0x34, 0x34, 0x32, 0x30, 0x07, 0x64, 0x69, 0x6C, 0x6C, 0x6F, 0x6E, 0x67, 0x65, 0x72</span><br></pre></td></tr></table></figure><p>解析：</p><ul><li><code>0x02</code> - Packet ID (0x02 for Login Success)</li><li><code>0x20</code> - UUID字符串长度 (VarInt: 32)</li><li><code>0x34, 0x30, 0x34, 0x38...</code> - UUID字符串 “40489242-4448-4842-4048-924448424420”</li><li><code>0x07</code> - Username字符串长度 (VarInt: 7)</li><li><code>0x64, 0x69, 0x6C, 0x6C, 0x6F, 0x6E, 0x67, 0x65, 0x72</code> - “dillonger”</li></ul><h2 id="5-Encryption-Request-包"><a href="#5-Encryption-Request-包" class="headerlink" title="5. Encryption Request 包"></a>5. Encryption Request 包</h2><p>如果服务器要求加密连接，它会发送Encryption Request包。</p><h3 id="5-1-包结构"><a href="#5-1-包结构" class="headerlink" title="5.1 包结构"></a>5.1 包结构</h3><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x01 (Encryption Request)</td></tr><tr><td>Server ID</td><td>String</td><td>服务器ID（通常为空字符串）</td></tr><tr><td>Public Key Length</td><td>VarInt</td><td>公钥长度</td></tr><tr><td>Public Key</td><td>Array of unsigned bytes</td><td>RSA公钥</td></tr><tr><td>Verify Token Length</td><td>VarInt</td><td>验证令牌长度</td></tr><tr><td>Verify Token</td><td>Array of unsigned bytes</td><td>验证令牌</td></tr></tbody></table><h2 id="6-Encryption-Response-包"><a href="#6-Encryption-Response-包" class="headerlink" title="6. Encryption Response 包"></a>6. Encryption Response 包</h2><p>客户端响应服务器的加密请求。</p><h3 id="6-1-包结构"><a href="#6-1-包结构" class="headerlink" title="6.1 包结构"></a>6.1 包结构</h3><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x01 (Encryption Response)</td></tr><tr><td>Shared Secret Length</td><td>VarInt</td><td>共享密钥长度</td></tr><tr><td>Shared Secret</td><td>Array of unsigned bytes</td><td>用公钥加密的共享密钥</td></tr><tr><td>Verify Token Length</td><td>VarInt</td><td>验证令牌长度</td></tr><tr><td>Verify Token</td><td>Array of unsigned bytes</td><td>用公钥加密的验证令牌</td></tr></tbody></table><h2 id="7-代码实现-Login-Start包解析器"><a href="#7-代码实现-Login-Start包解析器" class="headerlink" title="7. 代码实现 - Login Start包解析器"></a>7. 代码实现 - Login Start包解析器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginStartPacketParser</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LoginStartPacket</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> packetId;</span><br><span class="line">        <span class="keyword">public</span> String username;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">LoginStartPacket</span><span class="params">(<span class="type">int</span> packetId, String username)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.packetId = packetId;</span><br><span class="line">            <span class="built_in">this</span>.username = username;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;LoginStartPacket&#123;packetId=0x&quot;</span> + Integer.toHexString(packetId) + <span class="string">&quot;, username=&#x27;&quot;</span> + username + <span class="string">&quot;&#x27;&#125;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LoginStartPacket <span class="title function_">parse</span><span class="params">(<span class="type">byte</span>[] data)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data);</span><br><span class="line">        <span class="type">int</span> <span class="variable">packetId</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (packetId != <span class="number">0x00</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;无效的Login Start包ID: &quot;</span> + packetId);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> readString(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoginStartPacket</span>(packetId, username);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readVarInt</span><span class="params">(ByteArrayInputStream stream)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentByte;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            currentByte = stream.read();</span><br><span class="line">            <span class="keyword">if</span> (currentByte == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;读取VarInt时到达流末尾&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            value |= (currentByte &amp; <span class="number">0x7F</span>) &lt;&lt; position;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ((currentByte &amp; <span class="number">0x80</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            position += <span class="number">7</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;VarInt格式错误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">readString</span><span class="params">(ByteArrayInputStream stream)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        <span class="type">byte</span>[] stringData = <span class="keyword">new</span> <span class="title class_">byte</span>[length];</span><br><span class="line">        <span class="keyword">if</span> (stream.read(stringData) != length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;读取字符串时到达流末尾&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(stringData, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-代码实现-Login-Start包构建器"><a href="#8-代码实现-Login-Start包构建器" class="headerlink" title="8. 代码实现 - Login Start包构建器"></a>8. 代码实现 - Login Start包构建器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginStartPacketBuilder</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] build(String username) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Packet ID (0x00)</span></span><br><span class="line">        writeVarInt(stream, <span class="number">0x00</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Username</span></span><br><span class="line">        writeString(stream, username);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> stream.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeVarInt</span><span class="params">(ByteArrayOutputStream stream, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((value &amp; <span class="number">0xFFFFFF80</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                stream.write(value);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            stream.write((value &amp; <span class="number">0x7F</span>) | <span class="number">0x80</span>);</span><br><span class="line">            value &gt;&gt;&gt;= <span class="number">7</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeString</span><span class="params">(ByteArrayOutputStream stream, String value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">byte</span>[] stringData = value.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">        writeVarInt(stream, stringData.length);</span><br><span class="line">        stream.write(stringData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9-代码实现-Login-Success包解析器"><a href="#9-代码实现-Login-Success包解析器" class="headerlink" title="9. 代码实现 - Login Success包解析器"></a>9. 代码实现 - Login Success包解析器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginSuccessPacketParser</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LoginSuccessPacket</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> packetId;</span><br><span class="line">        <span class="keyword">public</span> String uuid;</span><br><span class="line">        <span class="keyword">public</span> String username;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">LoginSuccessPacket</span><span class="params">(<span class="type">int</span> packetId, String uuid, String username)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.packetId = packetId;</span><br><span class="line">            <span class="built_in">this</span>.uuid = uuid;</span><br><span class="line">            <span class="built_in">this</span>.username = username;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;LoginSuccessPacket&#123;packetId=0x&quot;</span> + Integer.toHexString(packetId) + </span><br><span class="line">                   <span class="string">&quot;, uuid=&#x27;&quot;</span> + uuid + <span class="string">&quot;&#x27;, username=&#x27;&quot;</span> + username + <span class="string">&quot;&#x27;&#125;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LoginSuccessPacket <span class="title function_">parse</span><span class="params">(<span class="type">byte</span>[] data)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data);</span><br><span class="line">        <span class="type">int</span> <span class="variable">packetId</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (packetId != <span class="number">0x02</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;无效的Login Success包ID: &quot;</span> + packetId);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> readString(stream);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> readString(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoginSuccessPacket</span>(packetId, uuid, username);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readVarInt</span><span class="params">(ByteArrayInputStream stream)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentByte;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            currentByte = stream.read();</span><br><span class="line">            <span class="keyword">if</span> (currentByte == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;读取VarInt时到达流末尾&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            value |= (currentByte &amp; <span class="number">0x7F</span>) &lt;&lt; position;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ((currentByte &amp; <span class="number">0x80</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            position += <span class="number">7</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;VarInt格式错误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">readString</span><span class="params">(ByteArrayInputStream stream)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        <span class="type">byte</span>[] stringData = <span class="keyword">new</span> <span class="title class_">byte</span>[length];</span><br><span class="line">        <span class="keyword">if</span> (stream.read(stringData) != length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;读取字符串时到达流末尾&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(stringData, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-代码实现-Login-Success包构建器"><a href="#10-代码实现-Login-Success包构建器" class="headerlink" title="10. 代码实现 - Login Success包构建器"></a>10. 代码实现 - Login Success包构建器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginSuccessPacketBuilder</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] build(String uuid, String username) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Packet ID (0x02)</span></span><br><span class="line">        writeVarInt(stream, <span class="number">0x02</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入UUID</span></span><br><span class="line">        writeString(stream, uuid);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Username</span></span><br><span class="line">        writeString(stream, username);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> stream.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用UUID对象构建</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] build(UUID uuid, String username) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> build(uuid.toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>), username);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeVarInt</span><span class="params">(ByteArrayOutputStream stream, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((value &amp; <span class="number">0xFFFFFF80</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                stream.write(value);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            stream.write((value &amp; <span class="number">0x7F</span>) | <span class="number">0x80</span>);</span><br><span class="line">            value &gt;&gt;&gt;= <span class="number">7</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeString</span><span class="params">(ByteArrayOutputStream stream, String value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">byte</span>[] stringData = value.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">        writeVarInt(stream, stringData.length);</span><br><span class="line">        stream.write(stringData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="11-代码实现-Encryption-Request包解析器"><a href="#11-代码实现-Encryption-Request包解析器" class="headerlink" title="11. 代码实现 - Encryption Request包解析器"></a>11. 代码实现 - Encryption Request包解析器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncryptionRequestPacketParser</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EncryptionRequestPacket</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> packetId;</span><br><span class="line">        <span class="keyword">public</span> String serverId;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span>[] publicKey;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span>[] verifyToken;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">EncryptionRequestPacket</span><span class="params">(<span class="type">int</span> packetId, String serverId, <span class="type">byte</span>[] publicKey, <span class="type">byte</span>[] verifyToken)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.packetId = packetId;</span><br><span class="line">            <span class="built_in">this</span>.serverId = serverId;</span><br><span class="line">            <span class="built_in">this</span>.publicKey = publicKey;</span><br><span class="line">            <span class="built_in">this</span>.verifyToken = verifyToken;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;EncryptionRequestPacket&#123;packetId=0x&quot;</span> + Integer.toHexString(packetId) + </span><br><span class="line">                   <span class="string">&quot;, serverId=&#x27;&quot;</span> + serverId + <span class="string">&quot;&#x27;, publicKey.length=&quot;</span> + publicKey.length + </span><br><span class="line">                   <span class="string">&quot;, verifyToken.length=&quot;</span> + verifyToken.length + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EncryptionRequestPacket <span class="title function_">parse</span><span class="params">(<span class="type">byte</span>[] data)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data);</span><br><span class="line">        <span class="type">int</span> <span class="variable">packetId</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (packetId != <span class="number">0x01</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;无效的Encryption Request包ID: &quot;</span> + packetId);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">serverId</span> <span class="operator">=</span> readString(stream);</span><br><span class="line">        <span class="type">int</span> <span class="variable">publicKeyLength</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        <span class="type">byte</span>[] publicKey = <span class="keyword">new</span> <span class="title class_">byte</span>[publicKeyLength];</span><br><span class="line">        <span class="keyword">if</span> (stream.read(publicKey) != publicKeyLength) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;读取公钥时到达流末尾&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">verifyTokenLength</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        <span class="type">byte</span>[] verifyToken = <span class="keyword">new</span> <span class="title class_">byte</span>[verifyTokenLength];</span><br><span class="line">        <span class="keyword">if</span> (stream.read(verifyToken) != verifyTokenLength) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;读取验证令牌时到达流末尾&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EncryptionRequestPacket</span>(packetId, serverId, publicKey, verifyToken);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readVarInt</span><span class="params">(ByteArrayInputStream stream)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentByte;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            currentByte = stream.read();</span><br><span class="line">            <span class="keyword">if</span> (currentByte == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;读取VarInt时到达流末尾&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            value |= (currentByte &amp; <span class="number">0x7F</span>) &lt;&lt; position;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ((currentByte &amp; <span class="number">0x80</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            position += <span class="number">7</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;VarInt格式错误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">readString</span><span class="params">(ByteArrayInputStream stream)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        <span class="type">byte</span>[] stringData = <span class="keyword">new</span> <span class="title class_">byte</span>[length];</span><br><span class="line">        <span class="keyword">if</span> (stream.read(stringData) != length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;读取字符串时到达流末尾&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(stringData, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-完整的Minecraft登录流程实现"><a href="#12-完整的Minecraft登录流程实现" class="headerlink" title="12. 完整的Minecraft登录流程实现"></a>12. 完整的Minecraft登录流程实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinecraftLoginHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 连接到Minecraft服务器并执行登录流程</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">connectAndLogin</span><span class="params">(String host, <span class="type">int</span> port, String username)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(host, port);</span><br><span class="line">        <span class="type">DataOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(socket.getOutputStream());</span><br><span class="line">        <span class="type">DataInputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(socket.getInputStream());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;正在连接到服务器 &quot;</span> + host + <span class="string">&quot;:&quot;</span> + port);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 1. 发送握手包 (连接到登录状态)</span></span><br><span class="line">            <span class="type">byte</span>[] handshakePacket = createHandshakePacket(<span class="number">754</span>, host, port, <span class="number">2</span>); <span class="comment">// 754 = MC 1.16.5, 2 = login state</span></span><br><span class="line">            writePacket(output, handshakePacket);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. 发送登录开始包</span></span><br><span class="line">            <span class="type">byte</span>[] loginStartPacket = LoginStartPacketBuilder.build(username);</span><br><span class="line">            writePacket(output, loginStartPacket);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. 等待服务器响应</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">packetLength</span> <span class="operator">=</span> readVarInt(input);</span><br><span class="line">            <span class="type">byte</span>[] packetData = <span class="keyword">new</span> <span class="title class_">byte</span>[packetLength];</span><br><span class="line">            input.readFully(packetData);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 检查包ID来判断服务器响应类型</span></span><br><span class="line">            <span class="type">ByteArrayInputStream</span> <span class="variable">packetStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(packetData);</span><br><span class="line">            <span class="type">int</span> <span class="variable">packetId</span> <span class="operator">=</span> readVarInt(packetStream);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (packetId == <span class="number">0x01</span>) &#123; <span class="comment">// Encryption Request</span></span><br><span class="line">                System.out.println(<span class="string">&quot;服务器要求加密&quot;</span>);</span><br><span class="line">                <span class="comment">// 处理加密请求</span></span><br><span class="line">                handleEncryptionRequest(input, output, packetData);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (packetId == <span class="number">0x02</span>) &#123; <span class="comment">// Login Success</span></span><br><span class="line">                System.out.println(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">                <span class="type">LoginSuccessPacket</span> <span class="variable">successPacket</span> <span class="operator">=</span> LoginSuccessPacketParser.parse(packetData);</span><br><span class="line">                System.out.println(<span class="string">&quot;UUID: &quot;</span> + successPacket.uuid);</span><br><span class="line">                System.out.println(<span class="string">&quot;用户名: &quot;</span> + successPacket.username);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 登录成功后，连接进入play状态</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (packetId == <span class="number">0x00</span>) &#123; <span class="comment">// Login Disconnect</span></span><br><span class="line">                System.out.println(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">                <span class="comment">// 解析断开连接消息</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">disconnectMessage</span> <span class="operator">=</span> readString(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(packetData));</span><br><span class="line">                System.out.println(<span class="string">&quot;断开连接原因: &quot;</span> + disconnectMessage);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;收到未知包ID: 0x&quot;</span> + Integer.toHexString(packetId));</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            socket.close();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleEncryptionRequest</span><span class="params">(DataInputStream input, DataOutputStream output, <span class="type">byte</span>[] originalPacketData)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 解析加密请求包</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">EncryptionRequestPacket</span> <span class="variable">encRequest</span> <span class="operator">=</span> EncryptionRequestPacketParser.parse(originalPacketData);</span><br><span class="line">            System.out.println(<span class="string">&quot;服务器加密请求: &quot;</span> + encRequest);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 在实际实现中，这里会：</span></span><br><span class="line">            <span class="comment">// 1. 使用服务器的公钥加密共享密钥</span></span><br><span class="line">            <span class="comment">// 2. 向Mojang认证服务器验证会话</span></span><br><span class="line">            <span class="comment">// 3. 发送加密响应包</span></span><br><span class="line">            <span class="comment">// 由于这涉及到实际的认证和加密，这里只做示例</span></span><br><span class="line">            </span><br><span class="line">            System.out.println(<span class="string">&quot;处理加密请求...&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;处理加密请求时出错: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] createHandshakePacket(<span class="type">int</span> protocolVersion, String host, <span class="type">int</span> port, <span class="type">int</span> nextState) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Packet ID (0x00)</span></span><br><span class="line">        writeVarInt(baos, <span class="number">0x00</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Protocol Version</span></span><br><span class="line">        writeVarInt(baos, protocolVersion);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Server Address</span></span><br><span class="line">        writeString(baos, host);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Server Port</span></span><br><span class="line">        baos.write((port &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>);</span><br><span class="line">        baos.write(port &amp; <span class="number">0xFF</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Next State</span></span><br><span class="line">        writeVarInt(baos, nextState);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> baos.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writePacket</span><span class="params">(DataOutputStream output, <span class="type">byte</span>[] packetData)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        writeVarInt(output, packetData.length);</span><br><span class="line">        output.write(packetData);</span><br><span class="line">        output.flush();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readVarInt</span><span class="params">(DataInputStream input)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentByte;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            currentByte = input.read();</span><br><span class="line">            <span class="keyword">if</span> (currentByte == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;读取VarInt时到达流末尾&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            value |= (currentByte &amp; <span class="number">0x7F</span>) &lt;&lt; position;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ((currentByte &amp; <span class="number">0x80</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            position += <span class="number">7</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;VarInt格式错误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeVarInt</span><span class="params">(OutputStream output, <span class="type">int</span> value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((value &amp; <span class="number">0xFFFFFF80</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                output.write(value);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            output.write((value &amp; <span class="number">0x7F</span>) | <span class="number">0x80</span>);</span><br><span class="line">            value &gt;&gt;&gt;= <span class="number">7</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeString</span><span class="params">(OutputStream output, String value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">byte</span>[] stringData = value.getBytes(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        writeVarInt(output, stringData.length);</span><br><span class="line">        output.write(stringData);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">readString</span><span class="params">(ByteArrayInputStream stream)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        <span class="type">byte</span>[] stringData = <span class="keyword">new</span> <span class="title class_">byte</span>[length];</span><br><span class="line">        <span class="keyword">if</span> (stream.read(stringData) != length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;读取字符串时到达流末尾&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(stringData, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 生成Minecraft会话验证URL</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createSessionURL</span><span class="params">(String serverHash, <span class="type">byte</span>[] sharedSecret, <span class="type">byte</span>[] publicKey)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MessageDigest</span> <span class="variable">digest</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;SHA-1&quot;</span>);</span><br><span class="line">            digest.update(serverHash.getBytes(<span class="string">&quot;ISO_8859_1&quot;</span>));</span><br><span class="line">            digest.update(sharedSecret);</span><br><span class="line">            digest.update(publicKey);</span><br><span class="line">            </span><br><span class="line">            <span class="type">byte</span>[] hash = digest.digest();</span><br><span class="line">            <span class="comment">// 将hash转换为十六进制字符串</span></span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">hexString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">byte</span> b : hash) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">hex</span> <span class="operator">=</span> Integer.toHexString(<span class="number">0xFF</span> &amp; b);</span><br><span class="line">                <span class="keyword">if</span> (hex.length() == <span class="number">1</span>) &#123;</span><br><span class="line">                    hexString.append(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                hexString.append(hex);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 这里应该调用Mojang的认证API</span></span><br><span class="line">            <span class="comment">// return &quot;https://sessionserver.mojang.com/session/minecraft/join&quot;;</span></span><br><span class="line">            <span class="keyword">return</span> hexString.toString();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="13-测试登录流程"><a href="#13-测试登录流程" class="headerlink" title="13. 测试登录流程"></a>13. 测试登录流程</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 测试连接到一个Minecraft服务器</span></span><br><span class="line">            <span class="comment">// 注意：这里只是一个示例，实际连接需要有效的服务器地址</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> MinecraftLoginHandler.connectAndLogin(<span class="string">&quot;localhost&quot;</span>, <span class="number">25565</span>, <span class="string">&quot;TestUser&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (success) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;登录流程完成&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;连接错误: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="14-认证流程详解"><a href="#14-认证流程详解" class="headerlink" title="14. 认证流程详解"></a>14. 认证流程详解</h2><p>在实际的Minecraft登录过程中，还有一个重要的认证步骤：</p><ol><li>客户端发送Login Start包</li><li>服务器可能发送Encryption Request包（如果启用了在线模式）</li><li>客户端使用服务器的公钥加密共享密钥和验证令牌</li><li>客户端向Mojang认证服务器验证会话</li><li>服务器验证客户端身份后发送Login Success包</li></ol><h3 id="14-1-会话验证"><a href="#14-1-会话验证" class="headerlink" title="14.1 会话验证"></a>14.1 会话验证</h3><p>如果服务器处于在线模式（online-mode&#x3D;true），客户端需要向Mojang的会话服务器验证会话：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是伪代码，展示概念</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">authenticateSession</span><span class="params">(String username, String serverHash, <span class="type">byte</span>[] sharedSecret, <span class="type">byte</span>[] publicKey)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 创建会话验证数据</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">hashedServerKey</span> <span class="operator">=</span> MinecraftLoginHandler.createSessionURL(serverHash, sharedSecret, publicKey);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 向Mojang会话服务器发送验证请求</span></span><br><span class="line">    <span class="comment">// POST到 https://sessionserver.mojang.com/session/minecraft/join</span></span><br><span class="line">    <span class="comment">// JSON数据: &#123;&quot;accessToken&quot;: &quot;...&quot;, &quot;selectedProfile&quot;: &quot;...&quot;, &quot;serverId&quot;: &quot;...&quot;&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 服务器验证后才会允许客户端继续</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="15-小结"><a href="#15-小结" class="headerlink" title="15. 小结"></a>15. 小结</h2><p>登录包是Minecraft协议中最复杂的部分之一，涉及用户认证、加密连接和会话验证。理解登录包的结构和流程是开发Minecraft客户端或服务器的核心知识。</p><p>在下一章中，我们将详细介绍Play状态下的各种包，这是游戏中实际交互的阶段，包括移动、聊天、物品交互等所有游戏内行为。</p><h2 id="16-重要注意事项"><a href="#16-重要注意事项" class="headerlink" title="16. 重要注意事项"></a>16. 重要注意事项</h2><ol><li><p><strong>在线模式 vs 离线模式</strong>：服务器可以配置为在线模式（需要正版验证）或离线模式（接受任意用户名）。在离线模式下，服务器可能不会发送Encryption Request。</p></li><li><p><strong>加密处理</strong>：在在线模式下，所有后续通信都需要使用共享密钥进行加密。</p></li><li><p><strong>压缩设置</strong>：服务器可能会发送Set Compression包来设置压缩阈值，这会影响后续所有包的传输。</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Minecraft协议（五）登录包详解&quot;&gt;&lt;a href=&quot;#Minecraft协议（五）登录包详解&quot; class=&quot;headerlink&quot; title=&quot;Minecraft协议（五）登录包详解&quot;&gt;&lt;/a&gt;Minecraft协议（五）登录包详解&lt;/h1&gt;&lt;p&gt;在前</summary>
      
    
    
    
    <category term="MinecraftProtocol" scheme="https://ooyyh.github.io/categories/MinecraftProtocol/"/>
    
    
    <category term="Minecraft" scheme="https://ooyyh.github.io/tags/Minecraft/"/>
    
    <category term="协议" scheme="https://ooyyh.github.io/tags/%E5%8D%8F%E8%AE%AE/"/>
    
    <category term="网络" scheme="https://ooyyh.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="登录包" scheme="https://ooyyh.github.io/tags/%E7%99%BB%E5%BD%95%E5%8C%85/"/>
    
    <category term="认证" scheme="https://ooyyh.github.io/tags/%E8%AE%A4%E8%AF%81/"/>
    
  </entry>
  
  <entry>
    <title>Minecraft协议（四）状态包详解</title>
    <link href="https://ooyyh.github.io/2026/01/04/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E5%9B%9B%EF%BC%89%E7%8A%B6%E6%80%81%E5%8C%85%E8%AF%A6%E8%A7%A3/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E5%9B%9B%EF%BC%89%E7%8A%B6%E6%80%81%E5%8C%85%E8%AF%A6%E8%A7%A3/"/>
    <id>https://ooyyh.github.io/2026/01/04/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E5%9B%9B%EF%BC%89%E7%8A%B6%E6%80%81%E5%8C%85%E8%AF%A6%E8%A7%A3/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E5%9B%9B%EF%BC%89%E7%8A%B6%E6%80%81%E5%8C%85%E8%AF%A6%E8%A7%A3/</id>
    <published>2026-01-04T14:34:53.000Z</published>
    <updated>2026-01-04T14:37:15.411Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Minecraft协议（四）状态包详解"><a href="#Minecraft协议（四）状态包详解" class="headerlink" title="Minecraft协议（四）状态包详解"></a>Minecraft协议（四）状态包详解</h1><p>在上一章中，我们详细解析了Minecraft协议中的握手包。本章将介绍状态包（Status Packet），这是在握手包之后用于获取服务器信息的包。</p><h2 id="1-状态包概述"><a href="#1-状态包概述" class="headerlink" title="1. 状态包概述"></a>1. 状态包概述</h2><p>当客户端在握手包中指定Next State为1（status）时，接下来就会进入状态阶段。在这个阶段，客户端可以发送请求服务器状态的包，服务器会返回其当前状态信息，包括玩家数量、服务器描述和版本信息。</p><h2 id="2-状态包类型"><a href="#2-状态包类型" class="headerlink" title="2. 状态包类型"></a>2. 状态包类型</h2><p>状态阶段包含两种包：</p><ul><li><strong>请求包</strong> (Client → Server): 客户端请求服务器状态</li><li><strong>响应包</strong> (Server → Client): 服务器返回状态信息</li></ul><h3 id="2-1-请求包"><a href="#2-1-请求包" class="headerlink" title="2.1 请求包"></a>2.1 请求包</h3><table><thead><tr><th>字段</th><th>类型</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x00</td><td>请求服务器状态</td></tr></tbody></table><h3 id="2-2-响应包"><a href="#2-2-响应包" class="headerlink" title="2.2 响应包"></a>2.2 响应包</h3><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>0x00 (对于响应包)</td></tr><tr><td>JSON Response</td><td>String</td><td>包含服务器状态的JSON字符串</td></tr></tbody></table><p>JSON Response的结构示例：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.16.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="number">754</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;players&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;max&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;online&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sample&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Notch&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;00000000-0000-0000-0000-000000000000&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A Minecraft Server&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;favicon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;data:image/png;base64,...&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="3-实际状态包示例"><a href="#3-实际状态包示例" class="headerlink" title="3. 实际状态包示例"></a>3. 实际状态包示例</h2><h3 id="客户端请求包"><a href="#客户端请求包" class="headerlink" title="客户端请求包"></a>客户端请求包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x00, 0x00</span><br></pre></td></tr></table></figure><ul><li><code>0x00</code> - Packet ID (0x00表示请求服务器状态)</li></ul><h3 id="服务器响应包示例"><a href="#服务器响应包示例" class="headerlink" title="服务器响应包示例"></a>服务器响应包示例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x00, 0x7B, 0x22, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x22, 0x3A, 0x7B, 0x22, 0x6E, 0x61, 0x6D, 0x65, 0x22, 0x3A, 0x22, 0x31, 0x2E, 0x31, 0x36, 0x2E, 0x35, 0x22, 0x2C, 0x22, 0x70, 0x72, 0x6F, 0x74, 0x6F, 0x63, 0x6F, 0x6C, 0x22, 0x3A, 0x37, 0x35, 0x34, 0x7D, 0x2C, 0x22, 0x70, 0x6C, 0x61, 0x79, 0x65, 0x72, 0x73, 0x22, 0x3A, 0x7B, 0x22, 0x6D, 0x61, 0x78, 0x22, 0x3A, 0x32, 0x30, 0x2C, 0x22, 0x6F, 0x6E, 0x6C, 0x69, 0x6E, 0x65, 0x22, 0x3A, 0x31, 0x7D, 0x2C, 0x22, 0x64, 0x65, 0x73, 0x63, 0x72, 0x69, 0x70, 0x74, 0x69, 0x6F, 0x6E, 0x22, 0x3A, 0x7B, 0x22, 0x74, 0x65, 0x78, 0x74, 0x22, 0x3A, 0x22, 0x41, 0x20, 0x4D, 0x69, 0x6E, 0x65, 0x63, 0x72, 0x61, 0x66, 0x74, 0x20, 0x53, 0x65, 0x72, 0x76, 0x65, 0x72, 0x22, 0x7D, 0x7D</span><br></pre></td></tr></table></figure><p>解析：</p><ul><li><code>0x00</code> - Packet ID</li><li>接下来的字节是JSON字符串”{“version”:{“name”:”1.16.5”,”protocol”:754},”players”:{“max”:20,”online”:1},”description”:{“text”:”A Minecraft Server”}}”</li></ul><h2 id="4-代码实现-状态请求包解析器"><a href="#4-代码实现-状态请求包解析器" class="headerlink" title="4. 代码实现 - 状态请求包解析器"></a>4. 代码实现 - 状态请求包解析器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatusRequestPacketParser</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">StatusRequestPacket</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> packetId;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">StatusRequestPacket</span><span class="params">(<span class="type">int</span> packetId)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.packetId = packetId;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;StatusRequestPacket&#123;packetId=0x&quot;</span> + Integer.toHexString(packetId) + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> StatusRequestPacket <span class="title function_">parse</span><span class="params">(<span class="type">byte</span>[] data)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data);</span><br><span class="line">        <span class="type">int</span> <span class="variable">packetId</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (packetId != <span class="number">0x00</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;无效的状态请求包ID: &quot;</span> + packetId);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StatusRequestPacket</span>(packetId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readVarInt</span><span class="params">(ByteArrayInputStream stream)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentByte;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            currentByte = stream.read();</span><br><span class="line">            <span class="keyword">if</span> (currentByte == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;读取VarInt时到达流末尾&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            value |= (currentByte &amp; <span class="number">0x7F</span>) &lt;&lt; position;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ((currentByte &amp; <span class="number">0x80</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            position += <span class="number">7</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;VarInt格式错误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-代码实现-状态响应包解析器"><a href="#5-代码实现-状态响应包解析器" class="headerlink" title="5. 代码实现 - 状态响应包解析器"></a>5. 代码实现 - 状态响应包解析器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatusResponsePacketParser</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">StatusResponsePacket</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> packetId;</span><br><span class="line">        <span class="keyword">public</span> String jsonResponse;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">StatusResponsePacket</span><span class="params">(<span class="type">int</span> packetId, String jsonResponse)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.packetId = packetId;</span><br><span class="line">            <span class="built_in">this</span>.jsonResponse = jsonResponse;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;StatusResponsePacket&#123;packetId=0x&quot;</span> + Integer.toHexString(packetId) + <span class="string">&quot;, jsonResponse=&#x27;&quot;</span> + jsonResponse + <span class="string">&quot;&#x27;&#125;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> StatusResponsePacket <span class="title function_">parse</span><span class="params">(<span class="type">byte</span>[] data)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data);</span><br><span class="line">        <span class="type">int</span> <span class="variable">packetId</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (packetId != <span class="number">0x00</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;无效的状态响应包ID: &quot;</span> + packetId);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonResponse</span> <span class="operator">=</span> readString(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StatusResponsePacket</span>(packetId, jsonResponse);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readVarInt</span><span class="params">(ByteArrayInputStream stream)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentByte;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            currentByte = stream.read();</span><br><span class="line">            <span class="keyword">if</span> (currentByte == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;读取VarInt时到达流末尾&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            value |= (currentByte &amp; <span class="number">0x7F</span>) &lt;&lt; position;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ((currentByte &amp; <span class="number">0x80</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            position += <span class="number">7</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;VarInt格式错误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">readString</span><span class="params">(ByteArrayInputStream stream)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        <span class="type">byte</span>[] stringData = <span class="keyword">new</span> <span class="title class_">byte</span>[length];</span><br><span class="line">        <span class="keyword">if</span> (stream.read(stringData) != length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;读取字符串时到达流末尾&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(stringData, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-代码实现-状态响应包构建器"><a href="#6-代码实现-状态响应包构建器" class="headerlink" title="6. 代码实现 - 状态响应包构建器"></a>6. 代码实现 - 状态响应包构建器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatusResponsePacketBuilder</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ServerStatus</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> String versionName;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> protocolVersion;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> maxPlayers;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> onlinePlayers;</span><br><span class="line">        <span class="keyword">public</span> String description;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ServerStatus</span><span class="params">(String versionName, <span class="type">int</span> protocolVersion, <span class="type">int</span> maxPlayers, <span class="type">int</span> onlinePlayers, String description)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.versionName = versionName;</span><br><span class="line">            <span class="built_in">this</span>.protocolVersion = protocolVersion;</span><br><span class="line">            <span class="built_in">this</span>.maxPlayers = maxPlayers;</span><br><span class="line">            <span class="built_in">this</span>.onlinePlayers = onlinePlayers;</span><br><span class="line">            <span class="built_in">this</span>.description = description;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] build(ServerStatus status) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 构建JSON响应字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonResponse</span> <span class="operator">=</span> <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  \&quot;version\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;name\&quot;: \&quot;&quot;</span> + status.versionName + <span class="string">&quot;\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;protocol\&quot;: &quot;</span> + status.protocolVersion + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &#125;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  \&quot;players\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;max\&quot;: &quot;</span> + status.maxPlayers + <span class="string">&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;online\&quot;: &quot;</span> + status.onlinePlayers + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &#125;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  \&quot;description\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;text\&quot;: \&quot;&quot;</span> + status.description + <span class="string">&quot;\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &#125;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Packet ID (0x00)</span></span><br><span class="line">        writeVarInt(stream, <span class="number">0x00</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入JSON响应字符串</span></span><br><span class="line">        writeString(stream, jsonResponse);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> stream.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeVarInt</span><span class="params">(ByteArrayOutputStream stream, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((value &amp; <span class="number">0xFFFFFF80</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                stream.write(value);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            stream.write((value &amp; <span class="number">0x7F</span>) | <span class="number">0x80</span>);</span><br><span class="line">            value &gt;&gt;&gt;= <span class="number">7</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeString</span><span class="params">(ByteArrayOutputStream stream, String value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">byte</span>[] stringData = value.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">        writeVarInt(stream, stringData.length);</span><br><span class="line">        stream.write(stringData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-代码实现-状态Ping请求包构建器"><a href="#7-代码实现-状态Ping请求包构建器" class="headerlink" title="7. 代码实现 - 状态Ping请求包构建器"></a>7. 代码实现 - 状态Ping请求包构建器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatusRequestPacketBuilder</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] build() <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Packet ID (0x00)</span></span><br><span class="line">        writeVarInt(stream, <span class="number">0x00</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> stream.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeVarInt</span><span class="params">(ByteArrayOutputStream stream, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((value &amp; <span class="number">0xFFFFFF80</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                stream.write(value);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            stream.write((value &amp; <span class="number">0x7F</span>) | <span class="number">0x80</span>);</span><br><span class="line">            value &gt;&gt;&gt;= <span class="number">7</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-实际测试"><a href="#8-实际测试" class="headerlink" title="8. 实际测试"></a>8. 实际测试</h2><p>让我们测试一下我们的状态包解析器和构建器：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatusTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 创建服务器状态对象</span></span><br><span class="line">        StatusResponsePacketBuilder.<span class="type">ServerStatus</span> <span class="variable">status</span> <span class="operator">=</span> </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">StatusResponsePacketBuilder</span>.ServerStatus(</span><br><span class="line">                <span class="string">&quot;1.16.5&quot;</span>, <span class="number">754</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="string">&quot;A Minecraft Server&quot;</span></span><br><span class="line">            );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 构建状态响应包</span></span><br><span class="line">        <span class="type">byte</span>[] responsePacket = StatusResponsePacketBuilder.build(status);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;构建的状态响应包数据:&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; responsePacket.length; i++) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;0x%02X &quot;</span>, responsePacket[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 解析状态响应包</span></span><br><span class="line">        <span class="type">StatusResponsePacket</span> <span class="variable">parsedResponse</span> <span class="operator">=</span> StatusResponsePacketParser.parse(responsePacket);</span><br><span class="line">        System.out.println(<span class="string">&quot;解析后的状态响应包:&quot;</span>);</span><br><span class="line">        System.out.println(parsedResponse);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 构建状态请求包</span></span><br><span class="line">        <span class="type">byte</span>[] requestPacket = StatusRequestPacketBuilder.build();</span><br><span class="line">        System.out.println(<span class="string">&quot;\n构建的状态请求包数据:&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; requestPacket.length; i++) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;0x%02X &quot;</span>, requestPacket[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 解析状态请求包</span></span><br><span class="line">        <span class="type">StatusRequestPacket</span> <span class="variable">parsedRequest</span> <span class="operator">=</span> StatusRequestPacketParser.parse(requestPacket);</span><br><span class="line">        System.out.println(<span class="string">&quot;解析后的状态请求包:&quot;</span>);</span><br><span class="line">        System.out.println(parsedRequest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9-完整的Minecraft状态查询实现"><a href="#9-完整的Minecraft状态查询实现" class="headerlink" title="9. 完整的Minecraft状态查询实现"></a>9. 完整的Minecraft状态查询实现</h2><p>下面是一个完整的Minecraft服务器状态查询实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinecraftStatusQuery</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ServerStatusInfo</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> String versionName;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> protocolVersion;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> maxPlayers;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> onlinePlayers;</span><br><span class="line">        <span class="keyword">public</span> String description;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;ServerStatusInfo&#123;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;  versionName=&#x27;&quot;</span> + versionName + <span class="string">&quot;&#x27;,\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;  protocolVersion=&quot;</span> + protocolVersion + <span class="string">&quot;,\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;  maxPlayers=&quot;</span> + maxPlayers + <span class="string">&quot;,\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;  onlinePlayers=&quot;</span> + onlinePlayers + <span class="string">&quot;,\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;  description=&#x27;&quot;</span> + description + <span class="string">&quot;&#x27;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ServerStatusInfo <span class="title function_">queryStatus</span><span class="params">(String host, <span class="type">int</span> port)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(host, port);</span><br><span class="line">        <span class="type">DataOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(socket.getOutputStream());</span><br><span class="line">        <span class="type">DataInputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(socket.getInputStream());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 发送握手包</span></span><br><span class="line">            <span class="type">byte</span>[] handshakePacket = createHandshakePacket(<span class="number">47</span>, host, port, <span class="number">1</span>); <span class="comment">// 47 = MC 1.8.x</span></span><br><span class="line">            writePacket(output, handshakePacket);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. 发送状态请求包</span></span><br><span class="line">            <span class="type">byte</span>[] requestPacket = StatusRequestPacketBuilder.build();</span><br><span class="line">            writePacket(output, requestPacket);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. 读取响应</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">packetLength</span> <span class="operator">=</span> readVarInt(input);</span><br><span class="line">            <span class="type">byte</span>[] packetData = <span class="keyword">new</span> <span class="title class_">byte</span>[packetLength];</span><br><span class="line">            input.readFully(packetData);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4. 解析响应</span></span><br><span class="line">            <span class="type">StatusResponsePacket</span> <span class="variable">response</span> <span class="operator">=</span> StatusResponsePacketParser.parse(packetData);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 这里应该解析JSON字符串并返回ServerStatusInfo对象</span></span><br><span class="line">            <span class="comment">// 为了简化，这里只是打印JSON</span></span><br><span class="line">            System.out.println(<span class="string">&quot;服务器响应JSON: &quot;</span> + response.jsonResponse);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> parseJsonToStatusInfo(response.jsonResponse);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            socket.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] createHandshakePacket(<span class="type">int</span> protocolVersion, String host, <span class="type">int</span> port, <span class="type">int</span> nextState) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Packet ID (0x00)</span></span><br><span class="line">        writeVarInt(baos, <span class="number">0x00</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Protocol Version</span></span><br><span class="line">        writeVarInt(baos, protocolVersion);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Server Address</span></span><br><span class="line">        writeString(baos, host);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Server Port</span></span><br><span class="line">        baos.write((port &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>);</span><br><span class="line">        baos.write(port &amp; <span class="number">0xFF</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Next State</span></span><br><span class="line">        writeVarInt(baos, nextState);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> baos.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writePacket</span><span class="params">(DataOutputStream output, <span class="type">byte</span>[] packetData)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        writeVarInt(output, packetData.length);</span><br><span class="line">        output.write(packetData);</span><br><span class="line">        output.flush();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readVarInt</span><span class="params">(DataInputStream input)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentByte;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            currentByte = input.read();</span><br><span class="line">            <span class="keyword">if</span> (currentByte == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;读取VarInt时到达流末尾&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            value |= (currentByte &amp; <span class="number">0x7F</span>) &lt;&lt; position;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ((currentByte &amp; <span class="number">0x80</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            position += <span class="number">7</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;VarInt格式错误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeVarInt</span><span class="params">(OutputStream output, <span class="type">int</span> value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((value &amp; <span class="number">0xFFFFFF80</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                output.write(value);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            output.write((value &amp; <span class="number">0x7F</span>) | <span class="number">0x80</span>);</span><br><span class="line">            value &gt;&gt;&gt;= <span class="number">7</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeString</span><span class="params">(OutputStream output, String value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">byte</span>[] stringData = value.getBytes(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        writeVarInt(output, stringData.length);</span><br><span class="line">        output.write(stringData);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ServerStatusInfo <span class="title function_">parseJsonToStatusInfo</span><span class="params">(String json)</span> &#123;</span><br><span class="line">        <span class="comment">// 这里应该使用JSON解析库来解析JSON字符串</span></span><br><span class="line">        <span class="comment">// 为了简化，我们返回一个示例对象</span></span><br><span class="line">        <span class="type">ServerStatusInfo</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerStatusInfo</span>();</span><br><span class="line">        info.versionName = <span class="string">&quot;1.16.5&quot;</span>;</span><br><span class="line">        info.protocolVersion = <span class="number">754</span>;</span><br><span class="line">        info.maxPlayers = <span class="number">20</span>;</span><br><span class="line">        info.onlinePlayers = <span class="number">1</span>;</span><br><span class="line">        info.description = <span class="string">&quot;A Minecraft Server&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-小结"><a href="#10-小结" class="headerlink" title="10. 小结"></a>10. 小结</h2><p>状态包是Minecraft协议中用于获取服务器信息的重要部分。通过握手包和状态包的组合，客户端可以获取服务器的基本信息，如版本、玩家数量等。在下一章中，我们将深入探讨登录包的详细结构和实现。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Minecraft协议（四）状态包详解&quot;&gt;&lt;a href=&quot;#Minecraft协议（四）状态包详解&quot; class=&quot;headerlink&quot; title=&quot;Minecraft协议（四）状态包详解&quot;&gt;&lt;/a&gt;Minecraft协议（四）状态包详解&lt;/h1&gt;&lt;p&gt;在上</summary>
      
    
    
    
    <category term="MinecraftProtocol" scheme="https://ooyyh.github.io/categories/MinecraftProtocol/"/>
    
    
    <category term="Minecraft" scheme="https://ooyyh.github.io/tags/Minecraft/"/>
    
    <category term="协议" scheme="https://ooyyh.github.io/tags/%E5%8D%8F%E8%AE%AE/"/>
    
    <category term="网络" scheme="https://ooyyh.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="状态包" scheme="https://ooyyh.github.io/tags/%E7%8A%B6%E6%80%81%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>Minecraft协议（三）握手包解析</title>
    <link href="https://ooyyh.github.io/2026/01/04/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%B8%89%EF%BC%89%E6%8F%A1%E6%89%8B%E5%8C%85%E8%A7%A3%E6%9E%90/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%B8%89%EF%BC%89%E6%8F%A1%E6%89%8B%E5%8C%85%E8%A7%A3%E6%9E%90/"/>
    <id>https://ooyyh.github.io/2026/01/04/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%B8%89%EF%BC%89%E6%8F%A1%E6%89%8B%E5%8C%85%E8%A7%A3%E6%9E%90/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%B8%89%EF%BC%89%E6%8F%A1%E6%89%8B%E5%8C%85%E8%A7%A3%E6%9E%90/</id>
    <published>2026-01-04T14:34:37.000Z</published>
    <updated>2026-01-04T14:36:04.424Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Minecraft协议（三）握手包解析"><a href="#Minecraft协议（三）握手包解析" class="headerlink" title="Minecraft协议（三）握手包解析"></a>Minecraft协议（三）握手包解析</h1><p>在前两章中，我们介绍了Minecraft协议的数据类型和登录状态。本章将详细解析Minecraft协议中的握手包（Handshake Packet），这是建立Minecraft服务器连接的第一个包。</p><h2 id="1-握手包概述"><a href="#1-握手包概述" class="headerlink" title="1. 握手包概述"></a>1. 握手包概述</h2><p>握手包是客户端连接到Minecraft服务器时发送的第一个数据包。它告知服务器客户端尝试连接的目标状态（status或login），以及目标服务器地址和端口。</p><h2 id="2-握手包结构"><a href="#2-握手包结构" class="headerlink" title="2. 握手包结构"></a>2. 握手包结构</h2><p>握手包的结构如下：</p><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Packet ID</td><td>VarInt</td><td>对于握手包，值为0x00</td></tr><tr><td>Protocol Version</td><td>VarInt</td><td>客户端的协议版本号</td></tr><tr><td>Server Address</td><td>String</td><td>服务器地址（如：localhost或127.0.0.1）</td></tr><tr><td>Server Port</td><td>Unsigned Short</td><td>服务器端口（如：25565）</td></tr><tr><td>Next State</td><td>VarInt</td><td>下一个状态（1为status，2为login）</td></tr></tbody></table><h2 id="3-实际握手包示例"><a href="#3-实际握手包示例" class="headerlink" title="3. 实际握手包示例"></a>3. 实际握手包示例</h2><p>让我们通过一个实际的握手包数据来理解其结构：</p><h3 id="客户端发送的握手包（连接到localhost-25565，准备获取服务器状态）"><a href="#客户端发送的握手包（连接到localhost-25565，准备获取服务器状态）" class="headerlink" title="客户端发送的握手包（连接到localhost:25565，准备获取服务器状态）"></a>客户端发送的握手包（连接到localhost:25565，准备获取服务器状态）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x00, 0x6B, 0x0F, 0x09, 0x6C, 0x6F, 0x63, 0x61, 0x6C, 0x68, 0x6F, 0x73, 0x74, 0x63, 0xDD, 0x01</span><br></pre></td></tr></table></figure><p>让我们逐步解析：</p><ul><li><code>0x00</code> - Packet ID (握手包的ID固定为0x00)</li><li><code>0x6B</code> - Protocol Version (VarInt: 107，对应Minecraft 1.9)</li><li><code>0x0F</code> - String长度(VarInt: 15，表示后面有15个字节的字符串)</li><li><code>0x09, 0x6C, 0x6F, 0x63, 0x61, 0x6C, 0x68, 0x6F, 0x73, 0x74</code> - “localhost”的UTF-8编码 (9字节 + 字符串结束符)</li><li><code>0x63, 0xDD</code> - Server Port (Unsigned Short: 0xDD63 &#x3D; 56675，十六进制表示)</li><li><code>0x01</code> - Next State (1表示status状态，准备获取服务器状态信息)</li></ul><h2 id="4-代码实现-解析握手包"><a href="#4-代码实现-解析握手包" class="headerlink" title="4. 代码实现 - 解析握手包"></a>4. 代码实现 - 解析握手包</h2><p>下面是一个用Java实现的握手包解析器：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HandshakePacketParser</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">HandshakePacket</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> packetId;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> protocolVersion;</span><br><span class="line">        <span class="keyword">public</span> String serverAddress;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> serverPort;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> nextState; <span class="comment">// 1=status, 2=login</span></span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;HandshakePacket&#123;&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;packetId=&quot;</span> + packetId +</span><br><span class="line">                    <span class="string">&quot;, protocolVersion=&quot;</span> + protocolVersion +</span><br><span class="line">                    <span class="string">&quot;, serverAddress=&#x27;&quot;</span> + serverAddress + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                    <span class="string">&quot;, serverPort=&quot;</span> + serverPort +</span><br><span class="line">                    <span class="string">&quot;, nextState=&quot;</span> + nextState +</span><br><span class="line">                    <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HandshakePacket <span class="title function_">parse</span><span class="params">(<span class="type">byte</span>[] data)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data);</span><br><span class="line">        <span class="type">HandshakePacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HandshakePacket</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取Packet ID (VarInt)</span></span><br><span class="line">        packet.packetId = readVarInt(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取Protocol Version (VarInt)</span></span><br><span class="line">        packet.protocolVersion = readVarInt(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取Server Address (String)</span></span><br><span class="line">        packet.serverAddress = readString(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取Server Port (Unsigned Short)</span></span><br><span class="line">        packet.serverPort = readUnsignedShort(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取Next State (VarInt)</span></span><br><span class="line">        packet.nextState = readVarInt(stream);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> packet;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 读取VarInt的辅助方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readVarInt</span><span class="params">(ByteArrayInputStream stream)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> currentByte;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            currentByte = stream.read();</span><br><span class="line">            <span class="keyword">if</span> (currentByte == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;读取VarInt时到达流末尾&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            value |= (currentByte &amp; <span class="number">0x7F</span>) &lt;&lt; position;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ((currentByte &amp; <span class="number">0x80</span>) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            position += <span class="number">7</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;VarInt格式错误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 读取String的辅助方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">readString</span><span class="params">(ByteArrayInputStream stream)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> readVarInt(stream);</span><br><span class="line">        <span class="type">byte</span>[] stringData = <span class="keyword">new</span> <span class="title class_">byte</span>[length];</span><br><span class="line">        <span class="keyword">if</span> (stream.read(stringData) != length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;读取字符串时到达流末尾&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(stringData, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 读取Unsigned Short的辅助方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">readUnsignedShort</span><span class="params">(ByteArrayInputStream stream)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ch1</span> <span class="operator">=</span> stream.read();</span><br><span class="line">        <span class="type">int</span> <span class="variable">ch2</span> <span class="operator">=</span> stream.read();</span><br><span class="line">        <span class="keyword">if</span> ((ch1 | ch2) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;读取Unsigned Short时到达流末尾&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (ch1 &lt;&lt; <span class="number">8</span>) + ch2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-代码实现-构建握手包"><a href="#5-代码实现-构建握手包" class="headerlink" title="5. 代码实现 - 构建握手包"></a>5. 代码实现 - 构建握手包</h2><p>下面是构建握手包的代码实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HandshakePacketBuilder</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] build(<span class="type">int</span> protocolVersion, String serverAddress, <span class="type">int</span> serverPort, <span class="type">int</span> nextState) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Packet ID (握手包ID为0x00)</span></span><br><span class="line">        writeVarInt(stream, <span class="number">0x00</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Protocol Version</span></span><br><span class="line">        writeVarInt(stream, protocolVersion);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Server Address</span></span><br><span class="line">        writeString(stream, serverAddress);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Server Port (Unsigned Short)</span></span><br><span class="line">        writeUnsignedShort(stream, serverPort);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写入Next State</span></span><br><span class="line">        writeVarInt(stream, nextState);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> stream.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 写入VarInt的辅助方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeVarInt</span><span class="params">(ByteArrayOutputStream stream, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((value &amp; <span class="number">0xFFFFFF80</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                stream.write(value);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            stream.write((value &amp; <span class="number">0x7F</span>) | <span class="number">0x80</span>);</span><br><span class="line">            value &gt;&gt;&gt;= <span class="number">7</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 写入String的辅助方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeString</span><span class="params">(ByteArrayOutputStream stream, String value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">byte</span>[] stringData = value.getBytes(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        writeVarInt(stream, stringData.length);</span><br><span class="line">        stream.write(stringData);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 写入Unsigned Short的辅助方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeUnsignedShort</span><span class="params">(ByteArrayOutputStream stream, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        stream.write((value &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>);</span><br><span class="line">        stream.write(value &amp; <span class="number">0xFF</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-实际测试"><a href="#6-实际测试" class="headerlink" title="6. 实际测试"></a>6. 实际测试</h2><p>让我们测试一下我们的握手包解析器：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HandshakeTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 模拟一个握手包，连接到localhost:25565，准备获取服务器状态</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">protocolVersion</span> <span class="operator">=</span> <span class="number">754</span>; <span class="comment">// Minecraft 1.16.5</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">serverAddress</span> <span class="operator">=</span> <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">serverPort</span> <span class="operator">=</span> <span class="number">25565</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">nextState</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">// status状态</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 构建握手包</span></span><br><span class="line">        <span class="type">byte</span>[] packet = HandshakePacketBuilder.build(protocolVersion, serverAddress, serverPort, nextState);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;构建的握手包数据:&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; packet.length; i++) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;0x%02X &quot;</span>, packet[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 解析握手包</span></span><br><span class="line">        <span class="type">HandshakePacket</span> <span class="variable">parsedPacket</span> <span class="operator">=</span> HandshakePacketParser.parse(packet);</span><br><span class="line">        System.out.println(<span class="string">&quot;解析后的握手包:&quot;</span>);</span><br><span class="line">        System.out.println(parsedPacket);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-常见问题和注意事项"><a href="#7-常见问题和注意事项" class="headerlink" title="7. 常见问题和注意事项"></a>7. 常见问题和注意事项</h2><ol><li><p><strong>协议版本</strong>：不同的Minecraft版本使用不同的协议版本号。需要根据目标Minecraft版本选择正确的协议版本。</p></li><li><p><strong>状态切换</strong>：握手包中的Next State字段决定了连接的下一个状态：</p><ul><li>1: status状态（用于ping服务器，获取服务器信息）</li><li>2: login状态（用于登录服务器）</li></ul></li><li><p><strong>地址格式</strong>：Server Address字段可以是IP地址或域名，但不应包含端口号。</p></li><li><p><strong>端口格式</strong>：Server Port是无符号短整型（2字节），范围是0-65535。</p></li></ol><h2 id="8-小结"><a href="#8-小结" class="headerlink" title="8. 小结"></a>8. 小结</h2><p>握手包是Minecraft协议中连接建立的第一个步骤。理解握手包的结构和解析方法是实现Minecraft客户端或服务器的基础。在下一章中，我们将详细讲解状态包（Status Packet）的结构和实现。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Minecraft协议（三）握手包解析&quot;&gt;&lt;a href=&quot;#Minecraft协议（三）握手包解析&quot; class=&quot;headerlink&quot; title=&quot;Minecraft协议（三）握手包解析&quot;&gt;&lt;/a&gt;Minecraft协议（三）握手包解析&lt;/h1&gt;&lt;p&gt;在前</summary>
      
    
    
    
    <category term="MinecraftProtocol" scheme="https://ooyyh.github.io/categories/MinecraftProtocol/"/>
    
    
    <category term="Minecraft" scheme="https://ooyyh.github.io/tags/Minecraft/"/>
    
    <category term="协议" scheme="https://ooyyh.github.io/tags/%E5%8D%8F%E8%AE%AE/"/>
    
    <category term="握手包" scheme="https://ooyyh.github.io/tags/%E6%8F%A1%E6%89%8B%E5%8C%85/"/>
    
    <category term="网络" scheme="https://ooyyh.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>Docker版本更换指南</title>
    <link href="https://ooyyh.github.io/2026/01/04/Docker%E7%89%88%E6%9C%AC%E6%9B%B4%E6%8D%A2%E6%8C%87%E5%8D%97/Docker%E7%89%88%E6%9C%AC%E6%9B%B4%E6%8D%A2%E6%8C%87%E5%8D%97/"/>
    <id>https://ooyyh.github.io/2026/01/04/Docker%E7%89%88%E6%9C%AC%E6%9B%B4%E6%8D%A2%E6%8C%87%E5%8D%97/Docker%E7%89%88%E6%9C%AC%E6%9B%B4%E6%8D%A2%E6%8C%87%E5%8D%97/</id>
    <published>2026-01-04T14:18:40.000Z</published>
    <updated>2026-01-04T14:25:40.063Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker-版本更换指南"><a href="#Docker-版本更换指南" class="headerlink" title="Docker 版本更换指南"></a>Docker 版本更换指南</h1><p>当需要降级或升级 Docker 版本时，本指南将帮助您完成操作。</p><h2 id="卸载旧版本"><a href="#卸载旧版本" class="headerlink" title="卸载旧版本"></a>卸载旧版本</h2><p>首先，删除老版本的所有 Docker 组件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除老版本的所有docker组件</span></span><br><span class="line">sudo apt remove -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清理配置</span></span><br><span class="line">sudo apt purge -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除残留文件</span></span><br><span class="line">sudo rm -rf /var/lib/docker /var/lib/containerd</span><br></pre></td></tr></table></figure><h2 id="添加官方仓库"><a href="#添加官方仓库" class="headerlink" title="添加官方仓库"></a>添加官方仓库</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新包列表</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install -y ca-certificates curl gnupg</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建密钥环目录</span></span><br><span class="line">sudo mkdir -p /etc/apt/keyrings</span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo tee /etc/apt/keyrings/docker.asc &gt; /dev/null</span><br><span class="line">sudo chmod a+r /etc/apt/keyrings/docker.asc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加 Docker 官方仓库</span></span><br><span class="line">echo \</span><br><span class="line">  &quot;deb [arch=amd64 signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \</span><br><span class="line"><span class="meta prompt_">  $</span><span class="language-bash">(lsb_release -cs) stable<span class="string">&quot; | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span></span></span><br><span class="line"></span><br><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><h2 id="查看可用版本"><a href="#查看可用版本" class="headerlink" title="查看可用版本"></a>查看可用版本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看可用的 Docker 版本</span></span><br><span class="line">apt-cache madison docker-ce</span><br></pre></td></tr></table></figure><p>![查看Docker版本](&#x2F;images&#x2F;Pasted image 20250320170449.png)</p><p>以25.0.1为例安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y docker-ce=5:25.0.1-1~ubuntu.22.04~jammy docker-ce-cli=5:25.0.1-1~ubuntu.22.04~jammy containerd.io</span><br></pre></td></tr></table></figure><h2 id="验证安装"><a href="#验证安装" class="headerlink" title="验证安装"></a>验证安装</h2><p>安装完成后，验证 Docker 版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker --version</span><br></pre></td></tr></table></figure><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li>更换版本前请确保已备份重要数据和容器镜像</li><li>不同版本的 Docker 可能存在兼容性问题</li><li>建议在测试环境中先验证版本更换操作</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Docker-版本更换指南&quot;&gt;&lt;a href=&quot;#Docker-版本更换指南&quot; class=&quot;headerlink&quot; title=&quot;Docker 版本更换指南&quot;&gt;&lt;/a&gt;Docker 版本更换指南&lt;/h1&gt;&lt;p&gt;当需要降级或升级 Docker 版本时，本指南将帮助</summary>
      
    
    
    
    <category term="DevOps" scheme="https://ooyyh.github.io/categories/DevOps/"/>
    
    
    <category term="Docker" scheme="https://ooyyh.github.io/tags/Docker/"/>
    
    <category term="版本管理" scheme="https://ooyyh.github.io/tags/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86/"/>
    
    <category term="容器技术" scheme="https://ooyyh.github.io/tags/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>Java注解实现指南</title>
    <link href="https://ooyyh.github.io/2026/01/04/Java%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97/Java%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97/"/>
    <id>https://ooyyh.github.io/2026/01/04/Java%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97/Java%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97/</id>
    <published>2026-01-04T14:18:29.000Z</published>
    <updated>2026-01-04T14:19:57.210Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java-如何实现一个注解"><a href="#Java-如何实现一个注解" class="headerlink" title="Java 如何实现一个注解"></a>Java 如何实现一个注解</h1><p>在开发框架时，注解是一个非常重要的概念。本文将详细介绍如何在Java中实现一个注解。</p><h2 id="1-认识注解"><a href="#1-认识注解" class="headerlink" title="1. 认识注解"></a>1. 认识注解</h2><p>要写注解首先要认识注解是什么，注解其实只是一个标记，类似于在笔记上做的标签，告诉编译器或者解释器要如何处理这个函数或者类，然后执行对应的操作。所以注解其实是写给程序看的，或者说写给编译器看的。</p><p>以下是一个简单的注解示例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.ooyyh.bytheway.annotation;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;  </span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span>  </span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span>  </span><br><span class="line"><span class="meta">@Documented</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AuthRequired &#123;  </span><br><span class="line">    String[] permissions() <span class="keyword">default</span> &#123;&#125;; <span class="comment">// 需要的权限列表  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="注解元素说明"><a href="#注解元素说明" class="headerlink" title="注解元素说明"></a>注解元素说明</h3><ul><li><code>@Target</code>：确定注解可以用在哪些地方。<code>ElementType.METHOD</code> 表示可以用于方法，<code>ElementType.TYPE</code> 表示可以用于类&#x2F;接口。</li><li><code>@Retention</code>：指定注解的生命周期。一般使用 <code>RetentionPolicy.RUNTIME</code>，这样注解在运行时仍然可用。</li><li><code>@Documented</code>：表示这个注解会被编译后写入Java doc。</li></ul><h2 id="2-如何实现注解功能"><a href="#2-如何实现注解功能" class="headerlink" title="2. 如何实现注解功能"></a>2. 如何实现注解功能</h2><p>注解声明之后，需要通过其他机制来实现具体的功能。常用的实现方式有：</p><ul><li>Spring 拦截器</li><li>Spring 过滤器</li><li>AOP（面向切面编程）</li><li>反射机制</li></ul><p>在实际项目中，通常使用 AOP 和拦截器来实现注解的具体功能。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>注解是Java中一个强大的特性，可以极大地简化代码的编写，特别是在框架开发中。通过合理使用注解，可以实现很多高级功能，如权限控制、日志记录、事务管理等。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Java-如何实现一个注解&quot;&gt;&lt;a href=&quot;#Java-如何实现一个注解&quot; class=&quot;headerlink&quot; title=&quot;Java 如何实现一个注解&quot;&gt;&lt;/a&gt;Java 如何实现一个注解&lt;/h1&gt;&lt;p&gt;在开发框架时，注解是一个非常重要的概念。本文将详细介</summary>
      
    
    
    
    <category term="编程语言" scheme="https://ooyyh.github.io/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
    <category term="Java" scheme="https://ooyyh.github.io/tags/Java/"/>
    
    <category term="注解" scheme="https://ooyyh.github.io/tags/%E6%B3%A8%E8%A7%A3/"/>
    
    <category term="框架开发" scheme="https://ooyyh.github.io/tags/%E6%A1%86%E6%9E%B6%E5%BC%80%E5%8F%91/"/>
    
    <category term="AOP" scheme="https://ooyyh.github.io/tags/AOP/"/>
    
  </entry>
  
  <entry>
    <title>Cloudflare-Workers入门指南</title>
    <link href="https://ooyyh.github.io/2026/01/04/Cloudflare-Workers%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/Cloudflare-Workers%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/"/>
    <id>https://ooyyh.github.io/2026/01/04/Cloudflare-Workers%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/Cloudflare-Workers%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/</id>
    <published>2026-01-04T14:18:17.000Z</published>
    <updated>2026-01-04T14:25:14.842Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Cloudflare-Workers-入门使用指南"><a href="#Cloudflare-Workers-入门使用指南" class="headerlink" title="Cloudflare Workers 入门使用指南"></a>Cloudflare Workers 入门使用指南</h1><p>Cloudflare Workers 是一个无服务器 (Serverless) 平台，允许您在 Cloudflare 的全球网络上运行 JavaScript、TypeScript 或 WebAssembly 代码，而无需配置或管理服务器。</p><h2 id="1-注册-Cloudflare"><a href="#1-注册-Cloudflare" class="headerlink" title="1. 注册 Cloudflare"></a>1. 注册 Cloudflare</h2><p>访问 <a href="https://dash.cloudflare.com/">https://dash.cloudflare.com/</a> 注册账户。注意：在国内网络环境下可能无法注册，需要使用代理。</p><h2 id="2-配置开发环境"><a href="#2-配置开发环境" class="headerlink" title="2. 配置开发环境"></a>2. 配置开发环境</h2><p>首先搭建 Node.js 环境。然后在桌面新建一个 code 文件夹，运行命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm create cloudflare</span><br></pre></td></tr></table></figure><p>按照提示完成项目初始化。</p><p>![Cloudflare项目初始化](&#x2F;images&#x2F;Pasted image 20250402180541.png)</p><h2 id="3-运行项目"><a href="#3-运行项目" class="headerlink" title="3. 运行项目"></a>3. 运行项目</h2><p>使用 Visual Studio Code 等 IDE 打开项目。项目的核心文件包括：</p><ul><li><strong>package.json</strong>：包含项目依赖，其中 Wrangler 是核心依赖</li><li><strong>wrangler.jsonc</strong>：Wrangler 的配置选项，可以关联使用 Cloudflare 的其他服务</li><li><strong>src&#x2F;index.js</strong>：默认导出一个 fetch 方法</li></ul><p>![项目结构](&#x2F;images&#x2F;Pasted image 20250402181616.png)</p><p>第二个核心配置文件就是 <strong>wrangler.jsonc</strong></p><p>![Wrangler配置文件](&#x2F;images&#x2F;Pasted image 20250402181839.png)</p><p>这里是 <strong>Wrangler</strong> 的一些配置选项，我们可以在这里并联使用cloudflare的全家桶服务。</p><p>第三个核心文件就是 <strong>src&#x2F;index.js</strong> 这个文件</p><p>![index.js文件](&#x2F;images&#x2F;Pasted image 20250402182052.png)</p><p>可以看到这里默认导出了一个fetch方法并返回了一个hello world。</p><p>那么我们使用之前在<strong>package.json</strong>里看到的script启动该服务<code>npm run dev</code></p><p>![本地运行服务](&#x2F;images&#x2F;Pasted image 20250402182449.png)</p><p>可以看到在本地8787端口下启动了一个服务。访问即可看到返回了一个<strong>HelloWorld</strong></p><p>![访问HelloWorld](&#x2F;images&#x2F;Pasted image 20250402182618.png)</p><h2 id="4-部署服务"><a href="#4-部署服务" class="headerlink" title="4. 部署服务"></a>4. 部署服务</h2><p>在部署之前，我们首先要登录自己的cloudflare账号（没有指向自己的账号的话难道部署到别人的号上去嘛awa）在网页端登录之后。在项目里输入命令 <code>npx wrangler login</code> 就会自动弹出浏览器授权登录</p><p>![登录Cloudflare](&#x2F;images&#x2F;Pasted image 20250402183254.png)</p><p>![授权登录](&#x2F;images&#x2F;Pasted image 20250402183406.png)</p><p><strong>点击允许</strong></p><p>![授权成功](&#x2F;images&#x2F;Pasted image 20250402183434.png)</p><p>到这我们就成功授权了wrangler对我们CF账号的操作</p><p>所以我们就可以直接使用wrangler部署我们的workers到全世界的CF节点了！！！</p><p>在命令窗里输入 <code>npx wrangler deploy</code><br>即可部署。</p><p>![部署成功](&#x2F;images&#x2F;Pasted image 20250402183651.png)</p><p>不报错即部署成功。我们回到浏览器上看看DashBorad点击 <strong>Workers和Pages</strong> 即可看到我们刚刚部署的服务</p><p>![查看部署的服务](&#x2F;images&#x2F;Pasted image 20250402183825.png)</p><p>![服务详情](&#x2F;images&#x2F;Pasted image 20250402183910.png)</p><p>点击访问即可看到CF为我们分配了一个免费的多级域名。虽然很丑陋但是对于我们免费用户来说又算得了什么呢awa。</p><p>![分配的域名](&#x2F;images&#x2F;Pasted image 20250402184026.png)</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过以上步骤，您已经成功配置并部署了第一个 Cloudflare Workers 服务。这个服务将在全球的 Cloudflare 节点上运行，无论用户在世界任何地方都可以快速访问。后续可以为 Workers 编写更复杂的逻辑，甚至集成数据库作为后端使用。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Cloudflare-Workers-入门使用指南&quot;&gt;&lt;a href=&quot;#Cloudflare-Workers-入门使用指南&quot; class=&quot;headerlink&quot; title=&quot;Cloudflare Workers 入门使用指南&quot;&gt;&lt;/a&gt;Cloudflare </summary>
      
    
    
    
    <category term="Web开发" scheme="https://ooyyh.github.io/categories/Web%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="Cloudflare" scheme="https://ooyyh.github.io/tags/Cloudflare/"/>
    
    <category term="Workers" scheme="https://ooyyh.github.io/tags/Workers/"/>
    
    <category term="Serverless" scheme="https://ooyyh.github.io/tags/Serverless/"/>
    
    <category term="JavaScript" scheme="https://ooyyh.github.io/tags/JavaScript/"/>
    
    <category term="入门指南" scheme="https://ooyyh.github.io/tags/%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/"/>
    
  </entry>
  
  <entry>
    <title>Docker安装指南</title>
    <link href="https://ooyyh.github.io/2026/01/04/Docker%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/Docker%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"/>
    <id>https://ooyyh.github.io/2026/01/04/Docker%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/Docker%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/</id>
    <published>2026-01-04T14:18:04.000Z</published>
    <updated>2026-01-04T14:18:54.348Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docker安装指南"><a href="#Docker安装指南" class="headerlink" title="Docker安装指南"></a>Docker安装指南</h1><p>在本文中，我将介绍最简单的Docker安装方法。</p><h2 id="最简单的安装方法"><a href="#最简单的安装方法" class="headerlink" title="最简单的安装方法"></a>最简单的安装方法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget get.docker.com</span><br><span class="line">bash index.html</span><br></pre></td></tr></table></figure><p>这种方法会自动检测您的系统并安装适合版本的Docker。</p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li>安装完成后，您可能需要将当前用户添加到docker组以避免使用sudo运行Docker命令：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure></li><li>重新登录或重启系统以使组权限生效。</li></ul><h2 id="验证安装"><a href="#验证安装" class="headerlink" title="验证安装"></a>验证安装</h2><p>安装完成后，可以通过运行以下命令验证Docker是否正常工作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker --version</span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><p>如果能看到”Hello from Docker!”消息，则表示Docker已成功安装并运行。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Docker安装指南&quot;&gt;&lt;a href=&quot;#Docker安装指南&quot; class=&quot;headerlink&quot; title=&quot;Docker安装指南&quot;&gt;&lt;/a&gt;Docker安装指南&lt;/h1&gt;&lt;p&gt;在本文中，我将介绍最简单的Docker安装方法。&lt;/p&gt;
&lt;h2 id=&quot;最</summary>
      
    
    
    
    <category term="DevOps" scheme="https://ooyyh.github.io/categories/DevOps/"/>
    
    
    <category term="Docker" scheme="https://ooyyh.github.io/tags/Docker/"/>
    
    <category term="容器技术" scheme="https://ooyyh.github.io/tags/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/"/>
    
    <category term="安装指南" scheme="https://ooyyh.github.io/tags/%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"/>
    
  </entry>
  
  <entry>
    <title>Minecraft协议（二）登录状态</title>
    <link href="https://ooyyh.github.io/2025/02/22/Minecraft/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%BA%8C%EF%BC%89%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81/"/>
    <id>https://ooyyh.github.io/2025/02/22/Minecraft/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%BA%8C%EF%BC%89%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81/</id>
    <published>2025-02-22T13:05:27.000Z</published>
    <updated>2025-02-22T13:13:01.629Z</updated>
    
    
    <summary type="html">介绍了Minecraft协议的第二部分也就是登录流程中的二种状态</summary>
    
    
    
    <category term="MinecraftProtocol" scheme="https://ooyyh.github.io/categories/MinecraftProtocol/"/>
    
    
    <category term="Minecraft" scheme="https://ooyyh.github.io/tags/Minecraft/"/>
    
  </entry>
  
  <entry>
    <title>Minecraft协议（一）数据类型</title>
    <link href="https://ooyyh.github.io/2025/02/22/Minecraft/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
    <id>https://ooyyh.github.io/2025/02/22/Minecraft/Minecraft%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</id>
    <published>2025-02-22T12:55:30.000Z</published>
    <updated>2025-02-22T13:02:29.883Z</updated>
    
    
    
    
    <category term="MinecraftProtocol" scheme="https://ooyyh.github.io/categories/MinecraftProtocol/"/>
    
    
    <category term="Minecraft" scheme="https://ooyyh.github.io/tags/Minecraft/"/>
    
  </entry>
  
</feed>
